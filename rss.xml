<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Bruno Luiz Silva]]></title><description><![CDATA[I do code | A collection of random software engineering thoughts.]]></description><link>https://brunoluiz.net</link><generator>RSS for Node</generator><lastBuildDate>Thu, 28 Nov 2019 23:57:37 GMT</lastBuildDate><item><title><![CDATA[GraphQL feat API Gateway]]></title><description><![CDATA[GraphQL, REST, gRPC, Thriftâ€¦ Have you ever imagined how to stick these together in a micro-services architecture and expose to the worldâ€¦]]></description><link>https://brunoluiz.net/graphql-as-a-gateway/</link><guid isPermaLink="false">https://brunoluiz.net/graphql-as-a-gateway/</guid><pubDate>Mon, 01 Jul 2019 08:00:00 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fb5da5c014432c6f403808a14ba084c5/295e7/cover.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.75398384632176%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAME/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwAE/9oADAMBAAIQAxAAAAHdC0Qs4fB//8QAGBABAAMBAAAAAAAAAAAAAAAAAAEEQUL/2gAIAQEAAQUC2yh1ZQ//xAAWEQADAAAAAAAAAAAAAAAAAAADEDH/2gAIAQMBAT8BNF//xAAWEQADAAAAAAAAAAAAAAAAAAADEDH/2gAIAQIBAT8BBF//xAAWEAEBAQAAAAAAAAAAAAAAAAACEAD/2gAIAQEABj8Cxpn/xAAZEAACAwEAAAAAAAAAAAAAAAAAARExcSH/2gAIAQEAAT8hVdL6OlbEoTrsvoSUf//aAAwDAQACAAMAAAAQYB//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8Q1Wv/xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAgEBPxCh/8QAHhAAAwAABwEAAAAAAAAAAAAAAAERIUFhcYGRwfD/2gAIAQEAAT8Qe7Y7XliuqVoOapUweQ8h9jHVqXB//9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by Christian Stahl on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/fb5da5c014432c6f403808a14ba084c5/bef22/cover.jpg&quot;
        srcset=&quot;/static/fb5da5c014432c6f403808a14ba084c5/257c2/cover.jpg 195w,
/static/fb5da5c014432c6f403808a14ba084c5/d0630/cover.jpg 390w,
/static/fb5da5c014432c6f403808a14ba084c5/bef22/cover.jpg 780w,
/static/fb5da5c014432c6f403808a14ba084c5/1257c/cover.jpg 1170w,
/static/fb5da5c014432c6f403808a14ba084c5/731f5/cover.jpg 1560w,
/static/fb5da5c014432c6f403808a14ba084c5/48b41/cover.jpg 2340w,
/static/fb5da5c014432c6f403808a14ba084c5/295e7/cover.jpg 4581w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;GraphQL, REST, gRPC, Thriftâ€¦ Have you ever imagined how to stick these together in a micro-services architecture and expose to the world? There are some common ways to do it, such as using Nginx or Kong. But, an alternative way to do this is by using GraphQL in front of all services.&lt;/p&gt;
&lt;h2&gt;API Gateway pattern â€” a quick introduction&lt;/h2&gt;
&lt;p&gt;Consider two services: A and B. How a client would be able to request its data? The easiest way would be to make a request to service A and then another to B, each pointing to a different host (eg: &lt;code&gt;a.service/orders&lt;/code&gt; and &lt;code&gt;b.service/users&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;As the number of services grows, it is quite laborious to keep using this strategy. Since there could be too many services and requests to coordinate. To solve this, an API proxy can be used, where the client will request to only one service instead of multiple. This proxy will orchestrate where this request should go, glueing all services in one place.&lt;/p&gt;
&lt;p&gt;While proxies just forward requests, API Gateways encapsulate more of the applicationâ€™s internal architecture. Working as a Facade with some other responsibilities, such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Request/Response Transformation: requests made by a client can be reshaped before being sent to internal services, with the same applying to responses.&lt;/li&gt;
&lt;li&gt;Request routing: as a proxy, it routes requests to specific services, translating to other protocols if required.&lt;/li&gt;
&lt;li&gt;Composition: one request to the gateway can actually be mapped to multiple internal ones.&lt;/li&gt;
&lt;li&gt;Throttling: limit user requests up to a determined threshold.&lt;/li&gt;
&lt;li&gt;Security: protect some endpoints with some sort of authentication (JWT token, basic, API tokens etc).&lt;/li&gt;
&lt;li&gt;Metrics and Logs: as all requests would pass through it, many metrics and logs will be collected through this service.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;For more information on the API gateway pattern, take a look at &lt;a href=&quot;https://www.nginx.com/blog/building-microservices-using-an-api-gateway/&quot;&gt;Nginx micro-services article&lt;/a&gt; and on this &lt;a href=&quot;https://freecontent.manning.com/the-api-gateway-pattern/&quot;&gt;Chris Richardson article&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Why GraphQL and not REST?&lt;/h2&gt;
&lt;p&gt;GraphQL was initially developed by Facebook and &lt;a href=&quot;https://code.fb.com/core-data/graphql-a-data-query-language/&quot;&gt;was open-sourced in 2015&lt;/a&gt;. Many companies started using it for internal APIs, but some are already exposing it as its public API (eg: GitHub, Shopify, Yelp and Contentful).&lt;/p&gt;
&lt;h3&gt;Schema validation and documentation&lt;/h3&gt;
&lt;p&gt;With GraphQL, in contrast to from REST, a schema is always required, following &lt;a href=&quot;https://graphql.org&quot;&gt;GraphQL Foundation&lt;/a&gt; directives. This allows not only schema validation from day one, but documentation too. Typed languages can benefit from the schema and generate type definitions through it (eg: &lt;a href=&quot;https://github.com/dotansimha/graphql-code-generator&quot;&gt;typescript graphql-code-generator&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-graphql line-numbers&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;type Query &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&quot;
  Fetch posts by user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; allowing custom filtering
  &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&quot;
  posts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; PostQueryInput&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Post&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

input PostQueryInput &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;categoryId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; String
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&quot;
Post bla bla bla
&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&quot;
type Post &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; String
  &lt;span class=&quot;token attr-name&quot;&gt;categories&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Category&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

type Category &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; String
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In theory, the same could be done with REST by using OpenAPI/Swagger, especially for documentation &lt;del&gt;but YAML, yikes&lt;/del&gt;. But, the code generation tools are not exactly the best and sometimes the schema validation does not work properly, requiring extra middleware and tweaks around it. As GraphQL is standardised in this sense, it doesnâ€™t suffer from these issues.&lt;/p&gt;
&lt;h3&gt;One endpoint to rule them all&lt;/h3&gt;
&lt;p&gt;GraphQL only exposes one endpoint. Instead of having N client requests, only one is needed. The server orchestrates everything required to fulfil the whole request, such as: calling multiple micro-services (with any protocol), mapping outputs to the expected schema and logging requests/responses. Besides, this solves &lt;a href=&quot;https://stackoverflow.com/questions/44564905/what-is-over-fetching-or-under-fetching/44568365&quot;&gt;under-fetching issues&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Out-of-box standards&lt;/h3&gt;
&lt;p&gt;REST has been around for a long time, and during this period developers started to have specific necessities, such as sparse fieldsets, versioning, pagination. There are many ways to implement these features but there arenâ€™t really any standards (the closest solution is &lt;a href=&quot;https://jsonapi.org/&quot;&gt;JSONAPI&lt;/a&gt;). GraphQL comes with some of these specs out-of-box:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://graphql.org/learn/queries/#fields&quot;&gt;Sparse fieldset&lt;/a&gt;: while making the request, all the required fields need to be specified, avoiding over-fetching&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://graphql.org/learn/best-practices/#versioning&quot;&gt;Versioning&lt;/a&gt;: route versioning is not a good practice in GraphQL instead, the schema should continually evolve. New capabilities can be inserted on new types and fields, allowing the client to plan and decide when to change to new resolvers. If a field needs to be deprecated, one can use a directive such as &lt;a href=&quot;https://www.apollographql.com/docs/graphql-tools/schema-directives&quot;&gt;&lt;code&gt;@deprecated&lt;/code&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://graphql.org/learn/pagination/&quot;&gt;Pagination&lt;/a&gt;: there are some conventions and, for more complex implementations, there is the Connection model pattern.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Of course, there is other stuff that one can compare against REST, but the idea is to show that GraphQL can be an option.&lt;/p&gt;
&lt;h3&gt;Developer experience&lt;/h3&gt;
&lt;p&gt;Front-end and back-end developers can easily settle on a schema and, in a question of minutes, have stubs built around it. Besides, code generation, IDE auto-completion, easy documentation/schema discovery and good API exploring tools (such as GraphQL Playground and GraphiQL) makes the development experience way nicer when compared to REST.&lt;/p&gt;
&lt;h2&gt;GraphQL as your API Gateway&lt;/h2&gt;
&lt;p&gt;High hopes that you are convinced on trying GraphQL ðŸ™Œ Implementing a GraphQL server is not complicated and there are many guides on the web talking about it. The official website &lt;a href=&quot;https://graphql.org/code&quot;&gt;has a list with many server frameworks and libraries&lt;/a&gt; (comes in many flavours).&lt;/p&gt;
&lt;p&gt;As mentioned in the first section, an API Gateway has some specific responsibilities. As GraphQL is implemented on top of a normal web server application, one can easily add some of these to it, such as authorisation, metrics and logging. Things such as requests/response transformation, routing and composition are done in the GraphQL resolver level, mapping calls to the right services, using the right communication protocols.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Even before going full micro-services and using it as a real API Gateway, companies can easily develop everything on top of a GraphQL monolith &lt;del&gt;wait, donâ€™t leave yet&lt;/del&gt; and then, with more time and planning, redirect the resolvers to micro-services. This is particularly useful for small companies, which are still testing ideas. During the migration, back-end might change a lot, but front-end will be able to continue requesting the same stuff.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;As teams develop micro-services, a strategy is required to expose and change the public-facing GraphQL schema. There are some known strategies for it:&lt;/p&gt;
&lt;h3&gt;Remote schema stitching&lt;/h3&gt;
&lt;p&gt;The gateway will get the schema from other GraphQL services and then stitch them together as the public-facing schema. This allows more freedom for teams, but it will disperse the API schema through multiple places, making it harder to test and easier to break, with a chance to have merge/stitching conflict.&lt;/p&gt;
&lt;p&gt;Although this can be a problem, teams can do releases without even touching the API Gateway, making the deploys isolated instead of requiring constant API Gateways deploys.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Recently, Apollo Server implemented &lt;a href=&quot;https://www.apollographql.com/docs/apollo-server/federation/introduction/&quot;&gt;Federation&lt;/a&gt;, which will replace remote schema stitching. Bear in mind it is still Apollo specific.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;API Gateway owns schemas&lt;/h3&gt;
&lt;p&gt;The Schema is contained locally on the gateway. This makes development and testing easier, as everything will be in the same place. The caveat is that the service will constantly be modified by multiple teams (resolvers, schemas), requiring constant gateway releases.&lt;/p&gt;
&lt;p&gt;As this service will be constantly modified by multiple people, rules around code formatting and style should be agreed through all teams to make the code uniform.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Personally, I prefer this one as it keeps everything in one place, gives high visibility on what is happening and allows easy discovery of other resolvers.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Combination of both above&lt;/h3&gt;
&lt;p&gt;It is possible to mix both strategies, which is especially useful if the team wants to use remote schema stitching but have some services using gRPC or HTTP. Another way to tackle those non-GraphQL services is to put a server in front of it, allowing schema stitching and giving more flexibility for the responsible team.&lt;/p&gt;
&lt;h2&gt;Caveats of using GraphQL&lt;/h2&gt;
&lt;h3&gt;Services can get a bit chatty&lt;/h3&gt;
&lt;p&gt;On the request below, a user wants all posts with its associated author.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-graphql line-numbers&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  posts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;authorId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bruno&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    title
    author &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The issue is, due to the nature of GraphQL, each resolved &lt;code&gt;post&lt;/code&gt; will call the &lt;code&gt;author&lt;/code&gt; resolver, resulting in &lt;code&gt;N-1&lt;/code&gt; unnecessary calls. Using SQL, it would give us:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Query.posts&lt;/code&gt; are resolved: &lt;code&gt;SELECT title, author_id FROM posts&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Query.posts&lt;/code&gt; still have un-resolved data about &lt;code&gt;Post.author.name&lt;/code&gt;. For each item, GraphQL will call &lt;code&gt;Post.author&lt;/code&gt; resolver&lt;/li&gt;
&lt;li&gt;Post A calls &lt;code&gt;Post.author&lt;/code&gt; resolver: &lt;code&gt;SELECT * FROM authors WHERE author_id = &apos;bruno&apos;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Post B calls &lt;code&gt;Post.author&lt;/code&gt; resolver again with the same query&lt;/li&gt;
&lt;li&gt;Post C calls &lt;code&gt;Post.author&lt;/code&gt; resolver again with the same query&lt;/li&gt;
&lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The two first selects would have returned the required data, but due to how GraphQL resolvers work â€” each resolved item with missing data calls the subsequent resolver â€” all these extra calls are made. This is where the &lt;a href=&quot;https://github.com/graphql/dataloader&quot;&gt;DataLoader&lt;/a&gt; pattern shines.&lt;/p&gt;
&lt;p&gt;Using batching and a cache (per-request only), it will lead your back-end only needing to make the right amount of calls. Probably even saving you from more calls, as the &lt;code&gt;author&lt;/code&gt; could have other resolvers to be called. In the previous example it would do something like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Query.posts&lt;/code&gt; are resolved: &lt;code&gt;SELECT title, author_id FROM posts&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Query.posts&lt;/code&gt; still have un-resolved data about &lt;code&gt;Post.author.name&lt;/code&gt;. For each item, the service would add a call to DataLoader with the required &lt;code&gt;author_id&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;After passing through all items, DataLoader would only execute &lt;code&gt;SELECT * FROM authors WHERE author_id = &apos;bruno&apos;&lt;/code&gt; query and return the response.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The JavaScript implementation is under 400 LOC, making it easier to explore and understand how it actually works. &lt;a href=&quot;https://github.com/graphql/dataloader/blob/master/README.md#other-implementations&quot;&gt;There are implementations in other languages as well&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MPJ, from FunFunFunction, released a &lt;a href=&quot;https://www.youtube.com/watch?v=lAJWHHUz8_8&amp;#x26;list=PL0zVEGEvSaeEjIDdbK1KfR7V9XBCVAr0P&quot;&gt;video series&lt;/a&gt; on how to implement GraphQL in NodeJS. &lt;a href=&quot;https://www.youtube.com/watch?v=--AguZ20lLA&amp;#x26;list=PL0zVEGEvSaeEjIDdbK1KfR7V9XBCVAr0P&amp;#x26;index=3&quot;&gt;Watch the DataLoader video here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Throttling is not easy as REST&lt;/h3&gt;
&lt;p&gt;Having everything in one endpoint makes harder to properly implement rate limits because the queries can be quite complex with multiple underlying requests but still one client request. This means an API user canâ€™t be limited through its number of calls to a certain endpoint anymore.&lt;/p&gt;
&lt;p&gt;An approach to tackle this is by calculating the query complexity and using it as a rate limit score. &lt;a href=&quot;https://developer.github.com/v4/guides/resource-limitations/&quot;&gt;On GitHub API docs&lt;/a&gt;, there are examples of how it works. But, this doesnâ€™t come out-of-box in most server implementations ðŸ˜ž There are some packages such as &lt;a href=&quot;https://github.com/4Catalyzer/graphql-validation-complexity&quot;&gt;&lt;code&gt;graphql-validation-complexity&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;https://github.com/pa-bru/graphql-cost-analysis&quot;&gt;&lt;code&gt;graphql-cost-analysis&lt;/code&gt;&lt;/a&gt;, where the latter is more advanced, with more options to limit the upcoming queries.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;graphql&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-graphql line-numbers&quot;&gt;&lt;code class=&quot;language-graphql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Usage example of graphql-cost-analysis&lt;/span&gt;
type Query &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# the cost will depend on the `limit` parameter passed to the field&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# then the multiplier will be added to the `parent multipliers` array&lt;/span&gt;
  customCostWithResolver&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Int
    &lt;span class=&quot;token directive function&quot;&gt;@cost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;multipliers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;limit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;complexity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# for recursive cost&lt;/span&gt;
  first&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; First
    &lt;span class=&quot;token directive function&quot;&gt;@cost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;multipliers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;limit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;useMultipliers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;complexity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# You can specify several field parameters in the `multipliers` array&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# then the values of the corresponding parameters will be added together.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# here, the cost will be `parent multipliers` * (`first` + `last`) * `complexity&lt;/span&gt;
  severalMultipliers&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Int
    &lt;span class=&quot;token directive function&quot;&gt;@cost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;multipliers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;first&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;last&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Caching is magic until it isnâ€™t&lt;/h3&gt;
&lt;p&gt;Most clients do caching automatically, but sometimes it doesnâ€™t work as expected, requiring some manual cleaning on the client. Besides, each request might ask for different fields, which makes a bit trickier to cache a resource on the server-side. One might request the whole resource, cache it in memory (eg: Redis), and then allow the API to use it as a reference to select specific fields.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Hopefully, this might have clarified some details of using GraphQL as an API gateway. For those who want to go deeper, there are some references below, from where I took notes for this post.&lt;/p&gt;
&lt;p&gt;Many thanks for &lt;a href=&quot;https://www.southcla.ws/&quot;&gt;@southclaws&lt;/a&gt;, &lt;a href=&quot;http://michalbock.com/&quot;&gt;@SpeedyCoder&lt;/a&gt;, &lt;a href=&quot;https://github.com/cassiobock&quot;&gt;@cassiobock&lt;/a&gt; and &lt;a href=&quot;https://www.codepreneur.io/&quot;&gt;@codepreneur&lt;/a&gt; for helping me by reviewing this post.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;h4&gt;API Gateway&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.nginx.com/blog/building-microservices-using-an-api-gateway/&quot;&gt;Ngnix micro-services book chapter about API Gateway&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://freecontent.manning.com/the-api-gateway-pattern/&quot;&gt;Chris Richardson article about API Gateway&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stoplight.io/blog/api-proxy-vs-api-gateway-c008c942a02d/&quot;&gt;API Proxy vs API Gateway&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://microservices.io/patterns/apigateway.html&quot;&gt;Pattern: API Gateway / Back-end for Front-End&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;GraphQL&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://graphql.org/learn/&quot;&gt;GraphQL Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.github.com/v4/guides/resource-limitations/&quot;&gt;GitHub GraphQL Resource Limitations Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tomasalabes.me/blog/graphql/node/microservices/2018/08/11/graphql-architectures.html&quot;&gt;GraphQL Gateway Architectures&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.robinwieruch.de/why-graphql-advantages-disadvantages-alternatives/&quot;&gt;Why GraphQL: Advantages, Disadvantages &amp;#x26; Alternatives&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://webapplog.com/graphql/&quot;&gt;Why GraphQL is Taking Over APIs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.apollographql.com/docs/graphql-tools/schema-stitching&quot;&gt;Schema stitching â€” Combining multiple GraphQL APIs into one&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.apollographql.com/apollo-federation-f260cf525d21&quot;&gt;Apollo Federation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=lAJWHHUz8_8&amp;#x26;list=PL0zVEGEvSaeEjIDdbK1KfR7V9XBCVAr0P&quot;&gt;FunFunFunction GraphQL Videos&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Tools&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dotansimha/graphql-code-generator&quot;&gt;Typescript &lt;code&gt;graphql-code-generator&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/graphql/dataloader&quot;&gt;DataLoader&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/4Catalyzer/graphql-validation-complexity&quot;&gt;&lt;code&gt;graphql-validation-complexity&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/pa-bru/graphql-cost-analysis&quot;&gt;&lt;code&gt;graphql-cost-analysis&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Images&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://unsplash.com/photos/8S96OpxSlvg&quot;&gt;Cover Photo by Christian Stahl on Unsplash&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Other&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://jsonapi.org/&quot;&gt;JSONAPI: REST alternative to GraphQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/44564905/what-is-over-fetching-or-under-fetching/44568365&quot;&gt;What is over and under-fetching&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Kubernetes devops productivity hacks]]></title><description><![CDATA[Today, Kubernetes is the de facto container orchestration solution. Together with the devops culture, developers have to get familiarised toâ€¦]]></description><link>https://brunoluiz.net/2019/mar/kubernetes-devops-productivity-hacks/</link><guid isPermaLink="false">https://brunoluiz.net/2019/mar/kubernetes-devops-productivity-hacks/</guid><pubDate>Thu, 14 Mar 2019 21:37:37 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/43bd152799fa31b547980eacc66082ea/58a7b/header.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.46173149309912%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAv/aAAwDAQACEAMQAAABwODQaCLH/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAEBESIf/aAAgBAQABBQIdXRYwwYDX/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8Bqv/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAIBBQAAAAAAAAAAAAAAAAABIQIRIDKB/9oACAEBAAY/AprS4bkO+H//xAAbEAACAgMBAAAAAAAAAAAAAAAAARFBECFRkf/aAAgBAQABPyGCNpRVa+CYEp0oZj//2gAMAwEAAgADAAAAELD/AP/EABgRAAIDAAAAAAAAAAAAAAAAAAARATFh/9oACAEDAQE/EFVE4P/EABgRAAIDAAAAAAAAAAAAAAAAAAABESFh/9oACAECAQE/EGrI0//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExcUH/2gAIAQEAAT8Qq+1Giw9i3T65g0uBIPf2WOy11n//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by Cameron Venti on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/43bd152799fa31b547980eacc66082ea/bef22/header.jpeg&quot;
        srcset=&quot;/static/43bd152799fa31b547980eacc66082ea/257c2/header.jpeg 195w,
/static/43bd152799fa31b547980eacc66082ea/d0630/header.jpeg 390w,
/static/43bd152799fa31b547980eacc66082ea/bef22/header.jpeg 780w,
/static/43bd152799fa31b547980eacc66082ea/1257c/header.jpeg 1170w,
/static/43bd152799fa31b547980eacc66082ea/731f5/header.jpeg 1560w,
/static/43bd152799fa31b547980eacc66082ea/48b41/header.jpeg 2340w,
/static/43bd152799fa31b547980eacc66082ea/58a7b/header.jpeg 3985w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Today, Kubernetes is the de facto container orchestration solution. Together with the devops culture, developers have to get familiarised to its tools, such as &lt;code&gt;kubectl&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;After some point though, using &lt;code&gt;kubectl&lt;/code&gt; for everything can get quite verbose, especially if you use many namespaces and contexts. The following tips try to minimise the pain of doing operations solely through it, sometimes even using other tools beside it.&lt;/p&gt;
&lt;h2&gt;Kubectx: context and namespaces management&lt;/h2&gt;
&lt;p&gt;Operations done in &lt;code&gt;kubectl&lt;/code&gt; usually require two params: &lt;strong&gt;context&lt;/strong&gt; and &lt;strong&gt;namespace&lt;/strong&gt;. Any operation will result in something as &lt;code&gt;kubectl --context dev --namespace hello-world exec -it hello-world-app-0 sh&lt;/code&gt;. It is fine for a one-time operation, but after some point, it can get quite cumbersome. One way to avoid these long command strings is by using &lt;a href=&quot;https://github.com/ahmetb/kubectx&quot;&gt;&lt;code&gt;kubectx&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;After installing it, the context can be set by simply using &lt;code&gt;kubectx dev&lt;/code&gt; and the namespace as &lt;code&gt;kubens hello-world&lt;/code&gt;. To list the available contexts and namespaces, just run it without arguments. The above operation can be run by only using &lt;code&gt;kubectl exec -it hello-world-app-0 sh&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Terminal aliases&lt;/h2&gt;
&lt;p&gt;Seasoned Unix developers are quite used to terminal aliases. Some are quite popular that are even grouped in packs, such as &lt;a href=&quot;https://github.com/robbyrussell/oh-my-zsh/blob/master/plugins/git/git.plugin.zsh&quot;&gt;oh-my-zsh git aliases&lt;/a&gt;. With Kubernetes is not that different.&lt;/p&gt;
&lt;p&gt;Usually, having &lt;code&gt;alias k=&quot;kubectl&quot;&lt;/code&gt; already make operations shorter. Using the same example, it would result in &lt;code&gt;k exec -it hello-world-app-0 sh&lt;/code&gt;. But, most likely, one alias will not be enough. There are some options for this.&lt;/p&gt;
&lt;p&gt;The first one can be set-up in any terminal emulator (&lt;code&gt;zsh&lt;/code&gt;, &lt;code&gt;bash&lt;/code&gt;â€¦). Get the &lt;code&gt;.kubectl_aliases&lt;/code&gt; file from &lt;a href=&quot;https://github.com/ahmetb/kubectl-aliases&quot;&gt;&lt;code&gt;ahmetb/kubectl-aliases&lt;/code&gt;&lt;/a&gt; and place it in your home directory. After sourcing it on &lt;code&gt;.zshrc&lt;/code&gt; or &lt;code&gt;.bashrc&lt;/code&gt;, 600 aliases will be available out-of-box, including the aforementioned &lt;code&gt;k&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; -f ~/.kubectl_aliases &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;source&lt;/span&gt; ~/.kubectl_aliases&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If &lt;a href=&quot;http://zsh.sourceforge.net/&quot;&gt;&lt;code&gt;zsh&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;https://ohmyz.sh/&quot;&gt;&lt;code&gt;oh-my-zsh&lt;/code&gt;&lt;/a&gt; are already set-up, an easier option would be to use the pre-installed &lt;code&gt;kubectl&lt;/code&gt; plugin. To enable it, edit your &lt;code&gt;.zshrc&lt;/code&gt; and add &lt;code&gt;kubectl&lt;/code&gt; to the &lt;code&gt;plugins&lt;/code&gt; variable (&lt;a href=&quot;https://github.com/robbyrussell/oh-my-zsh#plugins&quot;&gt;more details about oh-my-zsh plugins here&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;plugins&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;git kubectl &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are fewer aliases compared to &lt;code&gt;ahmetb/kubectl-aliases&lt;/code&gt;, making it easier to learn and faster to load. The list of &lt;code&gt;oh-my-zsh/kubectl&lt;/code&gt; aliases is &lt;a href=&quot;https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/kubectl&quot;&gt; available here &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectx&lt;/code&gt; and &lt;code&gt;kubens&lt;/code&gt; do not have aliases by default. To allow shorter calls for it, place the following on &lt;code&gt;.zshrc&lt;/code&gt; or &lt;code&gt;.bashrc&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;alias&lt;/span&gt; kns&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;kubens&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;alias&lt;/span&gt; kcx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;kubectx&quot;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After all these aliases been set-up, the &lt;code&gt;hello-world-app-0 sh&lt;/code&gt; can be accessed using a simple &lt;code&gt;keti hello-world-app-0 sh&lt;/code&gt;. As games, it will be as learning combat combos, although it will not be as close as a Hadouken combo.&lt;/p&gt;
&lt;h2&gt;Terminal namespace and context indicator&lt;/h2&gt;
&lt;p&gt;Developers are humans (in case you did not know) and humans do not have bulletproof memory. One can forget that kubernetes context is set to production and then run &lt;code&gt;kubectl apply&lt;/code&gt; there, instead of dev.&lt;/p&gt;
&lt;p&gt;To avoid this, an indicator can be used in the terminal to show what is the actual context and namespace. The easiest way to do it is by using &lt;a href=&quot;https://github.com/jonmosco/kube-ps1&quot;&gt;&lt;code&gt;kube-ps1&lt;/code&gt;&lt;/a&gt;. It already comes with &lt;code&gt;oh-my-zsh&lt;/code&gt;, requiring &lt;code&gt;kube-ps1&lt;/code&gt; to be added to &lt;code&gt;.zshrc&lt;/code&gt; plugins variable.&lt;/p&gt;
&lt;p&gt;After installing or enabling it, the PS1 needs to be changed to include the kubectl context and namespace information. This can be easily done by adding &lt;code&gt;export PS1=&apos;$(kube_ps1) &apos;$PS1&lt;/code&gt; to your &lt;code&gt;.bashrc/.zshrc&lt;/code&gt; file. The final result will be something like the following.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fec8d741f2ba7c6524e55de6cfa022f6/872b5/kube-ps1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 40.55118110236221%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSklEQVQoz53RPU/CQBjA8WqiLESB6Yhge/S9hcQQK6Et5VqKNUYniANIIjDxKYxfQDd3wQ9IchsJnM8hoIsDXvJLe22ef3qpIMB6953006SarxAXuZaDHLuOfMdDk9EEDftDNOqP0PhxjAYPA9Tr9FDnvosiv4XaQRvFjRhdkySfkCQtbFcnCl67dz5red48ikMaRR69vUloRAIah4S2wiYgNGwGlAQNGvgurdcc6tau+HXu1WvssnrxtguKijizDJWZGl4ZlswsW2blisZkpcgUVQTnGyJTtW+aLq3B/cowS0zCZ5+7IMaFDxMimo4XYLmmSUvDKC31P+GthWUpDJeK058gbCxbYfwlWO0JgjIEC9PfXzjjD/kRdB3vhc+YMCtBY9s7yGROklwu85LNnj7/B5/lDd4S7LLKo4fgCKTA8Z5Sm9lD+DnCFz+koApRzSnUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;kube-ps1 example&quot;
        title=&quot;&quot;
        src=&quot;/static/fec8d741f2ba7c6524e55de6cfa022f6/a6eaa/kube-ps1.png&quot;
        srcset=&quot;/static/fec8d741f2ba7c6524e55de6cfa022f6/39799/kube-ps1.png 195w,
/static/fec8d741f2ba7c6524e55de6cfa022f6/3eb93/kube-ps1.png 390w,
/static/fec8d741f2ba7c6524e55de6cfa022f6/a6eaa/kube-ps1.png 780w,
/static/fec8d741f2ba7c6524e55de6cfa022f6/f72ec/kube-ps1.png 1170w,
/static/fec8d741f2ba7c6524e55de6cfa022f6/872b5/kube-ps1.png 1524w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;The only issue with &lt;code&gt;kube-ps1&lt;/code&gt; is, when used with &lt;code&gt;git&lt;/code&gt; plugin in zsh, it can generate really long PS1 strings. If &lt;code&gt;tmux&lt;/code&gt; is used, it can be actually set-up in the status bar through &lt;a href=&quot;https://github.com/jonmosco/kube-tmux&quot;&gt;&lt;code&gt;kube-tmux&lt;/code&gt;&lt;/a&gt; plugin, avoiding PS1 cluttering.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d65a578682c3ed63225573b2126cc140/872b5/kube-tmux-ps1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 49.475065616797906%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAByUlEQVQoz52S30/TUBTHO3xgk63bMJcEZBu9be9tO2oQs18dlrHNxY0NeCC6YGIkAdEr+Hf4L/Aw+A945U/wQeU/waSPblfqabtJRvaA3uSTc9p+88npaQUBzkXr1cOP77Jz1U4VbdU7qN3YRK1aE73Z3UOfj07Qyftj9OmAocO3B+jD/hFqv9gco9Noz22/3BKF0dmxV750X1fdsl28LuVzjlXMO6VCzrHXLKe2sR5QsZ2N9TWnWnnuWAUvE+Sg/wmVF3LPLkH1wBempIXzlafLLqX4RiVLLqEBXq+qmQByy+i5D2Q0HbtYTl2BKphSklI9HW4SKvWpJt2MgycwlhnohuwqSuYbqOJD4WLPyCowoTQA3H+Ee0JZSX+fJOz7E1DpfgRvMHHCM08IOxl4O4KgvxcNKh1B7/SAt0NFTf/2qoQXf/wVYpw5NU3dzZrGr7JtcZXKfCnzmGMV86xGuYkx102dE0Pl1CCcLmvcgOvV1Sfctsv9er3ilkr5r6OPEhLFWCGRSLDk7COWSqdZNBZj4XCYRWZmWDwqskQkysRkkkXjcRbzgKwIzM8vMFlWmKEbx4SQJrimBatY9KXA1PA/+l9C3e6e8Ad9dNWZKftOjgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;kube-tmux example&quot;
        title=&quot;&quot;
        src=&quot;/static/d65a578682c3ed63225573b2126cc140/a6eaa/kube-tmux-ps1.png&quot;
        srcset=&quot;/static/d65a578682c3ed63225573b2126cc140/39799/kube-tmux-ps1.png 195w,
/static/d65a578682c3ed63225573b2126cc140/3eb93/kube-tmux-ps1.png 390w,
/static/d65a578682c3ed63225573b2126cc140/a6eaa/kube-tmux-ps1.png 780w,
/static/d65a578682c3ed63225573b2126cc140/f72ec/kube-tmux-ps1.png 1170w,
/static/d65a578682c3ed63225573b2126cc140/872b5/kube-tmux-ps1.png 1524w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2&gt;Investigating logs: the sane way&lt;/h2&gt;
&lt;p&gt;Failures can happen, debugs are required and check-ups are sometimes necessary. For all of these, application logs are needed. The standard way to open them is:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;kubectl --namespace dev --context labs get pods
&lt;span class=&quot;token comment&quot;&gt;# get the pod id&lt;/span&gt;
kubectl --namespace dev --context labs logs &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;pod-id&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; -f&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If the pod is killed and restarted, the process has to be repeated as the pod id will change. Besides, the &lt;code&gt;kubectl&lt;/code&gt; logs tool is quite simple in terms of features. &lt;a href=&quot;https://github.com/wercker/stern&quot;&gt;&lt;code&gt;stern&lt;/code&gt;&lt;/a&gt; is meant to be more powerful and allows to tail multiple pods and containers at once (even the whole namespace, if required).&lt;/p&gt;
&lt;p&gt;To tail pods, such as the hello-world example, &lt;code&gt;stern hello-world&lt;/code&gt; will do. It would tail everything using the &lt;code&gt;*hello-world*&lt;/code&gt; as an expression. If multiple pods were been run, it would log all hello-world pods.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;stern hello-world  &lt;span class=&quot;token comment&quot;&gt;# tail all pods containing &quot;hello-world&quot; in its name&lt;/span&gt;
stern &lt;span class=&quot;token keyword&quot;&gt;.&lt;/span&gt;            &lt;span class=&quot;token comment&quot;&gt;# tail all pods in current namespace&lt;/span&gt;
stern --since 1h &lt;span class=&quot;token keyword&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# tail logs from last one hour&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Shorter calls can be done setting up an alias, such as &lt;code&gt;alias s=&apos;stern&apos;&lt;/code&gt;. If set, it uses the &lt;code&gt;kubectx&lt;/code&gt; and &lt;code&gt;kubens&lt;/code&gt; settings, while accepting &lt;code&gt;--namespace&lt;/code&gt; and &lt;code&gt;--context&lt;/code&gt; args as well.&lt;/p&gt;
&lt;h2&gt;Automatic deployments&lt;/h2&gt;
&lt;p&gt;A way to avoid touching prod environment using &lt;code&gt;kubectl&lt;/code&gt; is by setting up &lt;a href=&quot;https://github.com/box/kube-applier&quot;&gt;&lt;code&gt;kube-applier&lt;/code&gt;&lt;/a&gt;. This service auto-deploy changes on infrastructure changes, based on a git repository.&lt;/p&gt;
&lt;p&gt;It runs as a separate pod, watching and comparing kubernetes manifest repository with deployed services. If there is a difference between manifests, it will automatically apply what is in the git repository, making it the source of truth for kube manifests.&lt;/p&gt;
&lt;p&gt;After installing &lt;code&gt;kube-applier&lt;/code&gt;, no deploys should be done through &lt;code&gt;kubectl&lt;/code&gt;, as it will always revert to git manifests. This avoids confusions around deployments made in a rush, not merged and then rollbacked by a mistake.&lt;/p&gt;
&lt;h2&gt;Add safety against wrong kubectl apply&lt;/h2&gt;
&lt;p&gt;If &lt;code&gt;kube-applier&lt;/code&gt; is not an option, perhaps it would be good to have a protection before &lt;code&gt;kubectl apply&lt;/code&gt; operations. There are many ways to do this, the following considers overwriting &lt;code&gt;kaf&lt;/code&gt; from &lt;code&gt;oh-my-zsh&lt;/code&gt; plugin. It adds a confirmation prompt and shows which context it will be applied to.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Confirm command to be executed&lt;/span&gt;
confirm&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; -n &lt;span class=&quot;token string&quot;&gt;&quot;\e[33mDo you want to run &lt;span class=&quot;token variable&quot;&gt;$*?&lt;/span&gt; [N/yes] \e[m&quot;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt; REPLY

  &lt;span class=&quot;token comment&quot;&gt;# if test &quot;$REPLY&quot; = &quot;y&quot; -o &quot;$REPLY&quot; = &quot;Y&quot;; then&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$REPLY&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;yes&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cancelled by user&quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

safe_kubectlapply&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  context&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;kubectl config current-context&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;BECAREFUL!!! APPLYING TO \e[31m&lt;span class=&quot;token variable&quot;&gt;$context&lt;/span&gt;\e[m&quot;&lt;/span&gt;
  confirm kubectl apply -f &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;alias&lt;/span&gt; kaf&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;safe_kubectlapply&apos;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This can pottentially save lifes. It can be modified to be used with other operations, such as &lt;code&gt;kdel&lt;/code&gt; and &lt;code&gt;kdelf&lt;/code&gt; (aliases for &lt;code&gt;kubectl delete&lt;/code&gt;).&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;These are just some tricks I use in my daily kubernetes life. Have a good coding week! ðŸ˜‰&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Cover photo by &lt;a href=&quot;https://unsplash.com/photos/QtETdXXR7gs?utm_source=unsplash&amp;#x26;utm_medium=referral&amp;#x26;utm_content=creditCopyText&quot;&gt;Cameron Venti&lt;/a&gt; on Unsplash&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ahmetb/kubectx&quot;&gt;&lt;code&gt;kubectx&lt;/code&gt; repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ahmetb/kubectl-aliases&quot;&gt;&lt;code&gt;ahmetb/kubectl-aliases&lt;/code&gt; repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/robbyrussell/oh-my-zsh&quot;&gt;&lt;code&gt;oh-my-zsh&lt;/code&gt; repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/kubectl&quot;&gt;&lt;code&gt;oh-my-zsh&lt;/code&gt; kubectl info&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jonmosco/kube-ps1&quot;&gt;&lt;code&gt;kube-ps1&lt;/code&gt; repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/kube-ps1&quot;&gt;&lt;code&gt;oh-my-zsh&lt;/code&gt; kube-ps1 info&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jonmosco/kube-tmux&quot;&gt;&lt;code&gt;kube-tmux&lt;/code&gt; repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/wercker/stern&quot;&gt;&lt;code&gt;stern&lt;/code&gt; repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/box/kube-applier&quot;&gt;&lt;code&gt;kube-applier&lt;/code&gt; repo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[A guide on npm package publishing]]></title><description><![CDATA[If you are not new in the JavaScript world, you might have already heard about  npm . It is a package manager which lets developers easilyâ€¦]]></description><link>https://brunoluiz.net/2019/feb/a-guide-to-npm-package-publishing/</link><guid isPermaLink="false">https://brunoluiz.net/2019/feb/a-guide-to-npm-package-publishing/</guid><pubDate>Fri, 15 Feb 2019 19:44:37 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7240830101bed0c6205181bc5b9ef6fb/d612b/header.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 64%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAQUAAAAAAAAAAAAAAAAAAAECAwQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwAC/9oADAMBAAIQAxAAAAFL2DOTOAs//8QAGhAAAgMBAQAAAAAAAAAAAAAAAgMAARIhI//aAAgBAQABBQJJBc8I0NNBmaF3S7f/xAAYEQACAwAAAAAAAAAAAAAAAAABAhASIf/aAAgBAwEBPwE1bTH/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8BNLW//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERIQIiMTL/2gAIAQEABj8C3VFIycnDySf/xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhMVFhcZH/2gAIAQEAAT8hugEdaYJMN+MLAbYjFG4ro+xW8p//2gAMAwEAAgADAAAAEDjP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERQf/aAAgBAwEBPxCjQiP/xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QQ4EP/8QAGxABAQEAAgMAAAAAAAAAAAAAAREAIVExQbH/2gAIAQEAAT8QWdSip9HzVz+iGIMnQ87lBVqtwjt7ZVCLs3//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by Paul Esch-Laurent on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/7240830101bed0c6205181bc5b9ef6fb/bef22/header.jpeg&quot;
        srcset=&quot;/static/7240830101bed0c6205181bc5b9ef6fb/257c2/header.jpeg 195w,
/static/7240830101bed0c6205181bc5b9ef6fb/d0630/header.jpeg 390w,
/static/7240830101bed0c6205181bc5b9ef6fb/bef22/header.jpeg 780w,
/static/7240830101bed0c6205181bc5b9ef6fb/1257c/header.jpeg 1170w,
/static/7240830101bed0c6205181bc5b9ef6fb/731f5/header.jpeg 1560w,
/static/7240830101bed0c6205181bc5b9ef6fb/d612b/header.jpeg 1600w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;If you are not new in the JavaScript world, you might have already heard about &lt;a href=&quot;https://www.npmjs.com/&quot;&gt;npm&lt;/a&gt;. It is a package manager which lets developers easily add dependencies to projects, as &lt;code&gt;npm install hello-world&lt;/code&gt;. But, have you ever asked, â€œHow do I create and publish my own packagesâ€?&lt;/p&gt;
&lt;h2&gt;How a package is composed?&lt;/h2&gt;
&lt;p&gt;Packages are quite simple to create in JavaScript. A &lt;code&gt;package.json&lt;/code&gt; and &lt;code&gt;index.js&lt;/code&gt; can already do the job. Look at &lt;code&gt;dedupe&lt;/code&gt; for example:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/65610ff0a36065606864f3ca8d8ed672/d8e31/dedupe.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 65.5625%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACTklEQVQ4y52S227TQBCG/RDwCvAk5poqF/A4japK3FBVhdK0Occ52GklBII34YabukpQ1DaxncT2Hu39GTuhaiTKBSv9mrF359uZ2bGCyeSFkMkBgP2tqkzmVa5MVWpUVY6qNqjm+Lt0jn2lzL7SOAij+KV1dHT85vOXr+iPPPQGLpyhi1bXQccZot0bYOBdoTf00Og4qLd7aJJtbNXs9FG7aKJ23kLPGeDg8PCtdXJ69npIQQN3LAkia62+OmsNVbM3Us5go25/qOgS1ez01Gmtrs4bLXV20VC1elM12l3ZHYwkncHR8cmetVgs9rBZVAHMf6qIRRCEFcv3/RKY05KSmzCcY70KwNganJRpDimSUloxsHRNlpc+FzF0Jk2W5SXQv7mpWJPJ5CFDxmIzX0wRhDNEy1sIEUHKZWk5DxFGM9zT/jK8xc+7H/juf4O/8h8yJNYuMFim5td9jFWqEMUSMc/AJCAzQGgglQZMofwfJQKzaEW+eBrIpTZ3K1V+MM4oowhJkiDLiGYoxpiNyrbRmZTK/hcwpeGbhRxFS9ZJirt5gCTlUDRkSmc70lmG5TpGyvjTQKEyE8Ta6MwYRdPKhTB5bnZe9PFKGTNCyl3gdDr9AzRFyfOVQE5HJGUlhISQiiTpRTc+XYDiDuIV2dGjqYceEKtiXV9f7xWbWmsTU78WiwAp9SZhKQWwMuixGBdF30qVvhAoqimAxKpY9Xr9meu6r0ajke15ru04jv3x0wf7feOdfXU5ti/HW239seeV8raWYu0itmAQ6/lvWLaOptvJ26YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;dedupe repository&quot;
        title=&quot;&quot;
        src=&quot;/static/65610ff0a36065606864f3ca8d8ed672/a6eaa/dedupe.png&quot;
        srcset=&quot;/static/65610ff0a36065606864f3ca8d8ed672/39799/dedupe.png 195w,
/static/65610ff0a36065606864f3ca8d8ed672/3eb93/dedupe.png 390w,
/static/65610ff0a36065606864f3ca8d8ed672/a6eaa/dedupe.png 780w,
/static/65610ff0a36065606864f3ca8d8ed672/f72ec/dedupe.png 1170w,
/static/65610ff0a36065606864f3ca8d8ed672/a660e/dedupe.png 1560w,
/static/65610ff0a36065606864f3ca8d8ed672/d8e31/dedupe.png 1600w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;There are other useful files such as &lt;code&gt;.gitignore&lt;/code&gt;, &lt;code&gt;.npmignore&lt;/code&gt;, &lt;code&gt;LICENSE&lt;/code&gt; and &lt;code&gt;README.md&lt;/code&gt;, but the main ones are there: &lt;code&gt;package.json&lt;/code&gt; and &lt;code&gt;index.js&lt;/code&gt;. Having these, the package just needs to be published in a repository, such as the &lt;a href=&quot;https://www.npmjs.com/&quot;&gt;npm public&lt;/a&gt;. Through this guide, you will be able to have a simple package published on npm.&lt;/p&gt;
&lt;h2&gt;Create an npm package&lt;/h2&gt;
&lt;p&gt;While doing &lt;a href=&quot;https://apimock.in&quot;&gt;apimock.in&lt;/a&gt;, I had to create multiple serverless stacks. Each had error handlers and, as most of the errors are quite the same, a good practice would be to extract these definitions into a package and just install it on each serverless stack. This use case will be used as an example through this post.&lt;/p&gt;
&lt;h3&gt;Create an npmjs.com account&lt;/h3&gt;
&lt;p&gt;Before doing anything, an account on &lt;a href=&quot;https://npmjs.com&quot;&gt;npmjs.com&lt;/a&gt; is required for publishing a package. This is the website for the npm public repository, used when &lt;code&gt;npm install ...&lt;/code&gt; is executed.&lt;/p&gt;
&lt;p&gt;To create an account, go to the &lt;a href=&quot;https://www.npmjs.com/signup&quot;&gt;npm signup page&lt;/a&gt; and fill up the form. After finishing the process, a test can be done using &lt;code&gt;npm login&lt;/code&gt; and &lt;code&gt;npm whoami&lt;/code&gt;. Has it output your username? Great! It is working!&lt;/p&gt;
&lt;!-- ![](https://cdn-images-1.medium.com/max/1600/1*sUm176ELamVqjUF1GUpiVw.gif) --&gt;
&lt;h3&gt;Some words about scopes&lt;/h3&gt;
&lt;p&gt;Scopes are useful in many ways, although not strictly required to publish an npm package. Every user has its own scope, defined as the npm user name.&lt;/p&gt;
&lt;p&gt;As only the developer/company can publish to its own scope, it is quite useful to indicate it is an official package. For example, one can publish a package called &lt;code&gt;xyz-sdk&lt;/code&gt;, but another called &lt;code&gt;xyz&lt;/code&gt; might already exist. How to know which to install? What if &lt;code&gt;xyz&lt;/code&gt; mimics &lt;code&gt;xyz-sdk&lt;/code&gt;, but with malicious code?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Each npm user/organisation has their own scope, and only you can add packages in your scope. This means you donâ€™t have to worry about someone taking your package name ahead of you. Thus it is also a good way to signal official packages for organisations. (&lt;a href=&quot;https://docs.npmjs.com/misc/scope&quot;&gt;from npm-scopes documentation&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A scoped package would have an &lt;code&gt;@account&lt;/code&gt; prefix. It would be published as &lt;code&gt;@account/xyz-sdk&lt;/code&gt;, hence easily identifiable as from a specific developer. Besides, the developer doesnâ€™t have to worry about name clashing, as the scope is account specific. It can be configured to point to a private repository as well, making it especially useful for companies.&lt;/p&gt;
&lt;p&gt;There is &lt;a href=&quot;https://docs.npmjs.com/misc/scope&quot;&gt;more information about scopes here&lt;/a&gt;. Keep in mind it is a good practice to scope packages.&lt;/p&gt;
&lt;h3&gt;Create a simple structure&lt;/h3&gt;
&lt;p&gt;In an empty folder, run &lt;code&gt;npm init â€”-scope=@your-npm-user&lt;/code&gt;. This will setup a &lt;code&gt;package.json&lt;/code&gt; and ask for some information, such as name, version, main entry file and author. The end result will be something like the following.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-json line-numbers&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;@brunoluiz/jsonapi-errors&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;JSONAPI Common Errors&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;index.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;jest&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bruno Luiz da Silva &amp;lt;contact@brunoluiz.net&gt; (http://brunoluiz.net/)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;MIT&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After having it initialised, is time to code something. Develop a basic implementation of it in the specified main file on &lt;code&gt;npm init&lt;/code&gt; setup (usually &lt;code&gt;index.js&lt;/code&gt;). If the package requires dependencies or there are files to be ignored on publishing, specify it on a &lt;code&gt;.gitignore&lt;/code&gt; file (eg: &lt;code&gt;node_modules&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;It is suggested to add a &lt;code&gt;LICENSE.md&lt;/code&gt; and a &lt;code&gt;README.md&lt;/code&gt;, as other developers might use this package. Usually, MIT or ISC licenses are fine to open-source projects, but &lt;a href=&quot;https://choosealicense.com/&quot;&gt;choosealicense.com&lt;/a&gt; can help on choosing another license.&lt;/p&gt;
&lt;h3&gt;Publish the package&lt;/h3&gt;
&lt;p&gt;The basic implementation is done and now is time to deploy it! On the first time, a &lt;code&gt;npm publish --access=public&lt;/code&gt; is required. The &lt;code&gt;access=public&lt;/code&gt; param is needed because scoped are &lt;code&gt;restricted&lt;/code&gt; by default. On following publishings, a &lt;code&gt;npm publish&lt;/code&gt; will do the job.&lt;/p&gt;
&lt;p&gt;Congratulations! You published your first package on npm. It should be available at &lt;code&gt;https://npmjs.com/package/@your-npm-user/package-name&lt;/code&gt; and ready to be installed through &lt;code&gt;npm install @your-npm-user/package-name&lt;/code&gt;.&lt;/p&gt;
&lt;!-- ![](https://cdn-images-1.medium.com/max/1600/1*oltzIY-eP8kDiK7mIlUVIQ.gif) --&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9be800ea5db75a774ea4524f0457875b/8f501/npm_published_module.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 65.17615176151762%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACP0lEQVQ4y42Sa04bMRDH9wbtHTjDXqLiUVU9BweALJWiSHkdpuoBKvUDlWihikggYfPYQEjzQKTJbtZeP9YzHZsSVSIfGOmv8fjx83jG3q/T7zvdsPlpHA2D8WQWTGfzoNONguubQdAOo+Cmd7tVvWgUhH0ad4dB73ZSaN/0i1+/ne54nXbnA5KBMSiVxjw3+FrLSTJlqNfcxWdnPz563TDcZaMRsuVSLlcrtSJxzlVG4k7spRhTaRwrLjK1vLxUv798FkwKvG5d7XthGO6ZPEchBMSrGAgK6/UasiwDAkLG/3mKN2PGQCbJk2ivktImi41G48CLomjPBo+LR3h4fID5fIZJkiC8+uFuqwM2m80DbzAYOGCW3EP8cAVZfIeac8zTFA3VVGca+R9OcxoNHUsThclSurHQBuNMgcrhJXAyGcMw6sP4foRUI9RKoaFGGWpSrnPngXLRBOFcoKJ1IaUVTW8BUjNACAlaa5RPG7e/DyyQkTK61KCSlJ7aApxOpxDHMUEFUgPw2f8vazYzxrirXJrQxRxAiS01pEaYxWJhqMOGMea8VZqmzhPQUPaGgIZeY6wpJQ1QYYiuN0Dq8r4NbEYE2ohASCA3tlnZUtiaWkvT9dZytFqt916n03lHhyWB016vR398xKynbBllxazR33Neac3uR3fs4uIn0zrfrJHWJDw/P9/1jo6O3lQqFT8IAv/4+NgvFApOpVLJr1arvl0rl8tONi4Wi/5JcOLXajU397xer9f9w8PDt38Bk7Cd8ji9wz4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Published package&quot;
        title=&quot;&quot;
        src=&quot;/static/9be800ea5db75a774ea4524f0457875b/a6eaa/npm_published_module.png&quot;
        srcset=&quot;/static/9be800ea5db75a774ea4524f0457875b/39799/npm_published_module.png 195w,
/static/9be800ea5db75a774ea4524f0457875b/3eb93/npm_published_module.png 390w,
/static/9be800ea5db75a774ea4524f0457875b/a6eaa/npm_published_module.png 780w,
/static/9be800ea5db75a774ea4524f0457875b/f72ec/npm_published_module.png 1170w,
/static/9be800ea5db75a774ea4524f0457875b/a660e/npm_published_module.png 1560w,
/static/9be800ea5db75a774ea4524f0457875b/32983/npm_published_module.png 2340w,
/static/9be800ea5db75a774ea4524f0457875b/8f501/npm_published_module.png 2952w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;Releasing new versions&lt;/h3&gt;
&lt;p&gt;After some iterations, the package might need new features and, therefore a new version. NPM packages use semantic versioning (&lt;a href=&quot;https://semver.org/&quot;&gt;SEMVER&lt;/a&gt;), but in a nutshell:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MAJOR version when you make incompatible API changes,&lt;/p&gt;
&lt;p&gt;MINOR version when you add functionality in a backwards-compatible manner, and&lt;/p&gt;
&lt;p&gt;PATCH version when you make backwards-compatible bug fixes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In the &lt;code&gt;jsonapi-errors&lt;/code&gt; example, a minor version increment is required. To do this, a &lt;code&gt;npm version minor&lt;/code&gt; can be used, where it will bump the &lt;code&gt;package.json&lt;/code&gt; version and add a tagged git commit. Then, a &lt;code&gt;npm publish&lt;/code&gt; will take care of pushing it (no need for &lt;code&gt;access&lt;/code&gt; parameter now). The version tags can be checked using &lt;code&gt;git log --decorate --oneline&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;b874866 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HEAD -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; master, tag: v0.2.0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 0.2.0
c5af2df chore: add new implementations
b8571cc &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tag: v0.1.0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 0.1.0
c5bf2ef chore: initial commit&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are &lt;a href=&quot;https://docs.npmjs.com/cli/version.html&quot;&gt;more information about the versioning process here&lt;/a&gt;.&lt;/p&gt;
&lt;!-- ![](https://cdn-images-1.medium.com/max/1600/1*gg3mGMbiQMFB7FKQQi8NzQ.gif) --&gt;
&lt;h3&gt;Using in local projects through linking&lt;/h3&gt;
&lt;p&gt;A simple way to test the new shiny package is through &lt;code&gt;npm install&lt;/code&gt;. It will work as expected but, if a change is required, a new version has to be published and the project dependency has to be upgraded to use the new one.&lt;/p&gt;
&lt;p&gt;This is unproductive, especially when a package is new and changes happen quite often. A way to solve it is through &lt;code&gt;npm link&lt;/code&gt;: it creates a symbolic link inside the project &lt;code&gt;node_modules&lt;/code&gt; folder, replacing the installed version with the local one.&lt;/p&gt;
&lt;p&gt;In the module folder, run &lt;code&gt;npm link&lt;/code&gt;, which will enable a global link for it. On the project folder, run &lt;code&gt;npm link &amp;#x3C;name&gt;&lt;/code&gt;. If the module is modified, projects using it through a link will have the latest version of it.&lt;/p&gt;
&lt;p&gt;After testing, two steps are required to remove it. The first is running &lt;code&gt;npm unlink --no-save &amp;#x3C;name&gt;&lt;/code&gt;, which removes the link from the project without touching &lt;code&gt;package.json&lt;/code&gt;. The second is &lt;code&gt;npm install&lt;/code&gt;, as the module is removed from &lt;code&gt;node_modules&lt;/code&gt; after unlinking.&lt;/p&gt;
&lt;p&gt;Removing the global link is not required, especially because it can be used later. If still needed, a &lt;code&gt;npm unlink&lt;/code&gt; in the module folder will do it.&lt;/p&gt;
&lt;h2&gt;Automate publishing process using CircleCI&lt;/h2&gt;
&lt;p&gt;If a package has many people collaborating to it, or the deploy process requires extra steps beside publishing it, an automated setup can improve the workflow. There are plenty of options, such as CircleCI, Travis and GitLab CI.&lt;/p&gt;
&lt;p&gt;On CircleCI Blog there is an &lt;a href=&quot;https://circleci.com/blog/publishing-npm-packages-using-circleci-2-0/&quot;&gt;article explaining in details how to do it&lt;/a&gt;, where:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;On feature branches, it will just run tests (eg: run tests on pull requests)&lt;/li&gt;
&lt;li&gt;On git &lt;code&gt;v*.*.*&lt;/code&gt; tag pushes, it will run tests and then publish to the NPM repository â€” remembering, a git version tag is generated by &lt;code&gt;npm version&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;More configurations can be added, such as saving coverage reports to a bucket or triggering specific web hooks after the jobs (eg: Slack).&lt;/p&gt;
&lt;h2&gt;Setup default npm init configs&lt;/h2&gt;
&lt;p&gt;Starting a package with &lt;code&gt;npm init&lt;/code&gt; is fine, but repeating the same information over and over can get quite boring. &lt;code&gt;npm config&lt;/code&gt; can be used to setup some default configs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; config &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; init-author-name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Bruno Luiz da Silva&apos;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; config &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; init-author-email&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;contact@brunoluiz.net&apos;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; config &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; init-author-url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://brunoluiz.net&apos;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; config &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; init-license&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;MIT&apos;&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These are saved at &lt;code&gt;~/.npmrc&lt;/code&gt;, together with other user configs.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# ~/.npmrc&lt;/span&gt;

init-author-name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Bruno Luiz da Silva
init-author-email&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;contact@brunoluiz.net
init-author-url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http://brunoluiz.net/
init-version&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1.0.0
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, a simple &lt;code&gt;npm init -y&lt;/code&gt; can be used to create packages. It will not ask for user input, using the npm configs instead and &lt;code&gt;@&amp;#x3C;scope&gt;/&amp;#x3C;folder-name&gt;&lt;/code&gt; as the name.&lt;/p&gt;
&lt;p&gt;There are many other configs available through it. Besides, projects can have their own specific configs and even environment variables can be used for it. Check &lt;a href=&quot;https://docs.npmjs.com/misc/config&quot;&gt;the npm documentation&lt;/a&gt; for more details.&lt;/p&gt;
&lt;h2&gt;Where to go now?&lt;/h2&gt;
&lt;p&gt;The steps shown in this article will cover most basic necessities on npm package publishing, but there are some specifics I havenâ€™t covered in this article.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Publish the package as TypeScript:&lt;/strong&gt; this allows code typing, more robust codes and, in editors such as VS Code, it enables a batter IntelliSense. &lt;a href=&quot;https://itnext.io/step-by-step-building-and-publishing-an-npm-typescript-package-44fe7164964c&quot;&gt;There is a quite complete article on
ITNext&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Publish it to a private repository:&lt;/strong&gt; there are some small different configurations, as pointing the package scope to the private repository. &lt;a href=&quot;https://docs.npmjs.com/creating-and-publishing-private-packages&quot;&gt;Give a look in this npm article&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[A Tale Of How To Not Deploy Two Months Old Features]]></title><description><![CDATA[There is one big and very special date on the e-commerce and retail market and itâ€™s called Black Friday. For many, it means â€œdiscount pricesâ€¦]]></description><link>https://brunoluiz.net/2018/mar/a-tale-of-how-to-not-deploy-two-months-old-features/</link><guid isPermaLink="false">https://brunoluiz.net/2018/mar/a-tale-of-how-to-not-deploy-two-months-old-features/</guid><pubDate>Wed, 07 Mar 2018 19:44:37 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a11126f471486b2d157de21ec1b44740/35506/header.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.7%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABTouS6kB//8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERAgMSIv/aAAgBAQABBQLyk6iGtQXJX2P/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAABBQEBAAAAAAAAAAAAAAABABARITECcf/aAAgBAQAGPwIwL9WAquYbG//EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhcaH/2gAIAQEAAT8hPqJZFrd7QsbUoPYuLidDLBP/2gAMAwEAAgADAAAAENjf/8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAIAQMBAT8QV//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/EFf/xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAxIVGxYXH/2gAIAQEAAT8QBipsfyENc85U4ShcLot2YVgChT7jUQoaesMUvar7gQFA+uf/2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by rawpixel.com on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/a11126f471486b2d157de21ec1b44740/bef22/header.jpeg&quot;
        srcset=&quot;/static/a11126f471486b2d157de21ec1b44740/257c2/header.jpeg 195w,
/static/a11126f471486b2d157de21ec1b44740/d0630/header.jpeg 390w,
/static/a11126f471486b2d157de21ec1b44740/bef22/header.jpeg 780w,
/static/a11126f471486b2d157de21ec1b44740/1257c/header.jpeg 1170w,
/static/a11126f471486b2d157de21ec1b44740/731f5/header.jpeg 1560w,
/static/a11126f471486b2d157de21ec1b44740/35506/header.jpeg 2000w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;There is one big and very special date on the e-commerce and retail market and itâ€™s called Black Friday. For many, it means â€œdiscount pricesâ€, â€œsale!â€, â€œ50% offâ€, but for developers and IT people it is a challenging adventure.&lt;/p&gt;
&lt;p&gt;To begin with, two weeks before, feature deployments are frozen and everything passes through load tests. On the week, machines are scaled up and, at the eventâ€™s day, all eyes are on metrics and logs.&lt;/p&gt;
&lt;p&gt;But there is a catch in this whole story: the feature development canâ€™t stop. This means features will begin to stack up soon after the feature deployment freeze and usually it continues a bit after the event, especially when your software is multi-tenant and each client has its own Black Friday agenda.&lt;/p&gt;
&lt;p&gt;In the case which gave this article its title, the deploy was delayed until close Christmas and, as it was Christmas, the team preferred to not deploy until the next year.&lt;/p&gt;
&lt;p&gt;January came by and, at some point, the delayed deploys would have to start. As four sprints have been passed since Black Friday, the usual process would be to deploy each sprint package atomically, monitoring its results in the production environment. But this, this is not an ideal world.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1f30eb10f91f81316fbb928cdd92a8c3/6a6aa/surprises.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.725%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAEukVNdQY//xAAbEAEAAQUBAAAAAAAAAAAAAAACAQADERITBP/aAAgBAQABBQLSMu3GuFFdUXPoTHRxX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAMAAwEBAAAAAAAAAAAAAAABEQISQSGR/9oACAEBAAY/Ase3o3q6nPSNv4b9MllCbM//xAAbEAACAgMBAAAAAAAAAAAAAAABEQAhMUFhUf/aAAgBAQABPyGrBJULYXg1AlVw1GFcHWhMYgn5B5JyABFjs//aAAwDAQACAAMAAAAQYN//xAAXEQEBAQEAAAAAAAAAAAAAAAABABFR/9oACAEDAQE/EAtOX//EABcRAAMBAAAAAAAAAAAAAAAAAAABEVH/2gAIAQIBAT8QdI9P/8QAGhABAQEBAQEBAAAAAAAAAAAAAREhAEExgf/aAAgBAQABPxBOsNAWnhsSaec9DdBjH5DzOoDAkWeb70Bv6XD+cmojIkabx4bAB4d//9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by rawpixel.com on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/1f30eb10f91f81316fbb928cdd92a8c3/bef22/surprises.jpeg&quot;
        srcset=&quot;/static/1f30eb10f91f81316fbb928cdd92a8c3/257c2/surprises.jpeg 195w,
/static/1f30eb10f91f81316fbb928cdd92a8c3/d0630/surprises.jpeg 390w,
/static/1f30eb10f91f81316fbb928cdd92a8c3/bef22/surprises.jpeg 780w,
/static/1f30eb10f91f81316fbb928cdd92a8c3/1257c/surprises.jpeg 1170w,
/static/1f30eb10f91f81316fbb928cdd92a8c3/731f5/surprises.jpeg 1560w,
/static/1f30eb10f91f81316fbb928cdd92a8c3/48b41/surprises.jpeg 2340w,
/static/1f30eb10f91f81316fbb928cdd92a8c3/6a6aa/surprises.jpeg 4000w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2&gt;Product Development Life Is Full Of Surprises&lt;/h2&gt;
&lt;p&gt;When a product is just in its early days, the first clients are tech early adopters and the development team have to be close to them, as their inputs are valuable.&lt;/p&gt;
&lt;p&gt;At some day in January, one of the major platformâ€™s clients informed they would launch more shops on the system. Besides the fact that, usually, some preparation is required, the biggest issue was that a specific feature was required. It had been developed at some point, but it was not well tested yet.&lt;/p&gt;
&lt;p&gt;Even worse, this feature depended on others, implemented in late November and early December, which means â€œGoodbye atomic deploysâ€: the team will have to prepare a deploy package with all four sprint features. Dangerous, isnâ€™t it? Remember the &lt;em&gt;challenging adventure&lt;/em&gt; part?&lt;/p&gt;
&lt;p&gt;While finishing and polishing the required feature, the QA team had to work deliberately to test all features again to be sure that everything would be pretty smooth. Even those which were already tested as, since November, some hotfixes were made on the production environment and who knows if they could have affected one of the already tested features.&lt;/p&gt;
&lt;p&gt;With the feature finished, the QA and management teams got together to test it. After a period of tests, they confirmed it was working as expected, with no bugs or business rules flaws. Even though this surprise feature made us work insanely, the deploy looked like it would be a walk in the park.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/28c8034c16b00d5b7c72abfcfce6eaf7/08036/deploy.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABQzabXJxj/8QAGRAAAwEBAQAAAAAAAAAAAAAAAQIDABIR/9oACAEBAAEFApOHBnucr+E2fkUI3//EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwGVl//EABYRAQEBAAAAAAAAAAAAAAAAAAASEf/aAAgBAgEBPwGsU//EABkQAAIDAQAAAAAAAAAAAAAAABAxAAECEf/aAAgBAQAGPwLm3LLH/8QAHRABAAIABwAAAAAAAAAAAAAAAQARITFBUWFx8f/aAAgBAQABPyFt0kJhoyN5XyPZU4Q6QCgJ/9oADAMBAAIAAwAAABB4P//EABYRAQEBAAAAAAAAAAAAAAAAAAARMf/aAAgBAwEBPxCdKf/EABcRAAMBAAAAAAAAAAAAAAAAAAABETH/2gAIAQIBAT8QrAlP/8QAGRABAQEBAQEAAAAAAAAAAAAAAREAIXFR/9oACAEBAAE/EEK4MRdCdUSGgtF+KJoAb7rHUY8d9+4bB83/2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by SpaceX on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/28c8034c16b00d5b7c72abfcfce6eaf7/bef22/deploy.jpeg&quot;
        srcset=&quot;/static/28c8034c16b00d5b7c72abfcfce6eaf7/257c2/deploy.jpeg 195w,
/static/28c8034c16b00d5b7c72abfcfce6eaf7/d0630/deploy.jpeg 390w,
/static/28c8034c16b00d5b7c72abfcfce6eaf7/bef22/deploy.jpeg 780w,
/static/28c8034c16b00d5b7c72abfcfce6eaf7/1257c/deploy.jpeg 1170w,
/static/28c8034c16b00d5b7c72abfcfce6eaf7/731f5/deploy.jpeg 1560w,
/static/28c8034c16b00d5b7c72abfcfce6eaf7/48b41/deploy.jpeg 2340w,
/static/28c8034c16b00d5b7c72abfcfce6eaf7/08036/deploy.jpeg 3000w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2&gt;D(eploy)-Day&lt;/h2&gt;
&lt;p&gt;It was 2 am when the whole deploy started. Low traffic and not that many orders flooding the system made it the perfect time to deploy the application. While deploying it, everything seemed fine, even though minor adjustments and migrations were needed. As soon as the clock hit 3h30 am, the team members were already wishing â€œGood Nightâ€ to each other.&lt;/p&gt;
&lt;p&gt;For a package with a lot of features and one quite critical, it was quite smoothâ€¦ and this is when things started to fall apart. At 4 pm, one of the clients started to complain about some orders not being registered due to HTTP 400 errors and some inventory not being updated for no reason. &lt;em&gt;â€œWHAT THE F&lt;/em&gt;CK IS GOING ON!â€ *everybody said, in despair.&lt;/p&gt;
&lt;p&gt;All developers stopped to investigate the problem and, of course, hidden in the middle of one of the sprint release packages, there were two bugs: one related to how the application dealt with the inventory queue producer and the other related to how addresses were validated. Ten lines of code worth of trouble.&lt;/p&gt;
&lt;p&gt;After roughly one hour of stress, everything was calm again, but the results of this deploy changed the entire team.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/69f917759485c550e5d50f8fe92e3f1e/35506/postmortem.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.64999999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAE264WSA//EABsQAAICAwEAAAAAAAAAAAAAAAIRAQMABBIx/9oACAEBAAEFAqunVTImXD1/HklL/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAgMBAAAAAAAAAAAAAAAAAAECESEQ/9oACAEBAAY/ApK8ZbNG+//EABwQAQACAgMBAAAAAAAAAAAAAAEAETFBIVFhsf/aAAgBAQABPyEIFieemA1s37FmFz7FTCG0n//aAAwDAQACAAMAAAAQy+//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QAsv/xAAWEQEBAQAAAAAAAAAAAAAAAAABACH/2gAIAQIBAT8QVtv/xAAbEAEBAAMAAwAAAAAAAAAAAAABEQAhMWFxof/aAAgBAQABPxCajxfomTitgcbcKLgql4w0ZY2c39zmlQdnjP/Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by Dustin Lee on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/69f917759485c550e5d50f8fe92e3f1e/bef22/postmortem.jpeg&quot;
        srcset=&quot;/static/69f917759485c550e5d50f8fe92e3f1e/257c2/postmortem.jpeg 195w,
/static/69f917759485c550e5d50f8fe92e3f1e/d0630/postmortem.jpeg 390w,
/static/69f917759485c550e5d50f8fe92e3f1e/bef22/postmortem.jpeg 780w,
/static/69f917759485c550e5d50f8fe92e3f1e/1257c/postmortem.jpeg 1170w,
/static/69f917759485c550e5d50f8fe92e3f1e/731f5/postmortem.jpeg 1560w,
/static/69f917759485c550e5d50f8fe92e3f1e/35506/postmortem.jpeg 2000w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2&gt;THAT Post-Mortem And Its Results&lt;/h2&gt;
&lt;p&gt;Soon after, a post-mortem had been written. Everybody collaborated: developers, managers, and QAs. The information contained in this single document would allow the team to learn, grow and know better how to deal with problems like this in the future.&lt;/p&gt;
&lt;p&gt;At the other day, a morning meeting was scheduled to discuss the points written in the post-mortem. Besides the issues from the deploy itself, many other problems arose in the heat of the discussion. All members agreed on the pointed issues and suggested some actions to tackle them.&lt;/p&gt;
&lt;h3&gt;Deploy age&lt;/h3&gt;
&lt;p&gt;One could point to the code and say it was a bug, but it was not only that. Deploys that are too many weeks old are a problem, as it has features developed way too long ago, where devs and testers probably donâ€™t remember all specifics for these. This can lead to database issues (if a migration was forgotten), schema validation problems, business rules flaws, and so on.&lt;/p&gt;
&lt;p&gt;The best way to tackle this is to deploy the feature package not too long after the sprint has been finished. Everything will be fresh for all team members and no git gimmicks will be required for this (rebase hell mostly).&lt;/p&gt;
&lt;h3&gt;Rushed deploys&lt;/h3&gt;
&lt;p&gt;Never do rush deploys, especially big ones. The team will get stressed, communication probably will not be the best, documents (such as the release notes) can have errors or miss information. In this deploy, one of the features was not specified on the JIRA Release Board, but it was on the GitHub release. A developer with more time would have noticed that some stuff was missing.&lt;/p&gt;
&lt;p&gt;These release notes usually will not only be used by the clients, but by the QAs as well, as it will have which features will be deployed. As these have impacts on everybody, the best thing to do is to have a consensus on what can be fully delivered (developer side) and well tested (QA side). The idea is to avoid features which can have bugs or not well tested because they were made in a rush.&lt;/p&gt;
&lt;h3&gt;Create Processes&lt;/h3&gt;
&lt;p&gt;Usually, people love to complain about â€œprocessesâ€. Some people even say they love startups because of the lack of them. But they exist for a reason and, in this case, it would have helped if everything followed a well-defined process.&lt;/p&gt;
&lt;p&gt;There was already a process, but it was not that specific. After the incident, the team got together and wrote a document describing each step of the product feature development, with a pipe of what should be done on each step of it: feature discussions and development, peer reviews metrics, deploy and release notes for tests environments, test processes and finally, the production deploy.&lt;/p&gt;
&lt;p&gt;Is it more bureaucratic? For sure! But until now, there were no complains by the team members and, especially, the client.&lt;/p&gt;
&lt;h3&gt;More Automated Tests&lt;/h3&gt;
&lt;p&gt;Each sprint feature package is tested by QAs in a staging environment. The best scenario is to have a lot of different automated test scenarios, which would give 100% guarantee that nothing will break the APIs.&lt;/p&gt;
&lt;p&gt;But, this isnâ€™t a perfect world. The usual is to have part of it automated and part of it is tested by humans. But, as this aging deploy was urgent and made in a rush, some features passed through without being well tested.&lt;/p&gt;
&lt;p&gt;How to solve this problem? Well, one side of the problem is organization: a board tool would help with this but, as aging deploys such as this one have too many tasks, the best thing to do is organize THAT release note. The QA team will be able then to plan how to do its tests.&lt;/p&gt;
&lt;p&gt;The other side, which is a bit more complicated, is to create more automated tests. Not only QAs but developers as well. Everybody knows someone who wants to skip the test development, but this can help to avoid countless problems (especially in the future). The other developers should not allow a feature to go on without automated tests for it. The same applies for QAs.&lt;/p&gt;
&lt;h3&gt;Error Metrics Monitoring and Alerts&lt;/h3&gt;
&lt;p&gt;Soon after the deploy, the team has checked some error metrics on &lt;a href=&quot;https://www.graylog.org&quot;&gt;Graylog&lt;/a&gt; and &lt;a href=&quot;https://aws.amazon.com/cloudwatch/&quot;&gt;CloudWatch&lt;/a&gt;, but these error metrics were just for a part of the system, not its whole. If more metrics had been monitored, probably the problem would have been discovered way before and the impact would have been smaller.&lt;/p&gt;
&lt;p&gt;The team should monitor at least some of these metrics manually, through dashboards or even the application log, but the best way to tackle this is through automated alerts. Nowadays, all major IaaS providers have a service for metrics and logs. With CloudWatch (AWS), the team can set alerts for when too many error HTTP responses are given by the applications on a certain determined period. It can send e-mails, SMS and even be integrated with mobile apps such as &lt;a href=&quot;https://www.opsgenie.com/&quot;&gt;OpsGenie&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are other tools besides these, such as &lt;a href=&quot;https://newrelic.com/&quot;&gt;NewRelic&lt;/a&gt; and &lt;a href=&quot;https://www.librato.com/&quot;&gt;Librato&lt;/a&gt;, but they are a bit more specific and the team should analyze if they are really required.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4c7cb5c043852f9237594a41551e399f/6a6aa/noproblems.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.64999999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAG95JcOYg//xAAaEAADAAMBAAAAAAAAAAAAAAAAAQIDBBIh/9oACAEBAAEFApg5HPs0x5qQ9iz/xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQMBAT8Byj//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQIBAT8B0r//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAADAQEBAAAAAAAAAAAAAAAAARExIZH/2gAIAQEAAT8hNThfoS0uRIv1eH//2gAMAwEAAgADAAAAEIMf/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EAFm/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/EK1b/8QAHBAAAgICAwAAAAAAAAAAAAAAAREAITFRQWFx/9oACAEBAAE/EKRUVa6PMtgD8iYE60oJCh1MHF//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by Kupono Kuwamura on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/4c7cb5c043852f9237594a41551e399f/bef22/noproblems.jpeg&quot;
        srcset=&quot;/static/4c7cb5c043852f9237594a41551e399f/257c2/noproblems.jpeg 195w,
/static/4c7cb5c043852f9237594a41551e399f/d0630/noproblems.jpeg 390w,
/static/4c7cb5c043852f9237594a41551e399f/bef22/noproblems.jpeg 780w,
/static/4c7cb5c043852f9237594a41551e399f/1257c/noproblems.jpeg 1170w,
/static/4c7cb5c043852f9237594a41551e399f/731f5/noproblems.jpeg 1560w,
/static/4c7cb5c043852f9237594a41551e399f/48b41/noproblems.jpeg 2340w,
/static/4c7cb5c043852f9237594a41551e399f/6a6aa/noproblems.jpeg 4000w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2&gt;End Of Problems?&lt;/h2&gt;
&lt;p&gt;This will not be the last problem the team will have to struggle with. Stressful moments like these will appear but this is when the team will learn and grow, being able to rise and aim towards high stakes through time.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Joi: validate input and define databases in JavaScript]]></title><description><![CDATA[As the saying goes:  never trust user input . People coming from PHP and Java have many validation libraries available. But what aboutâ€¦]]></description><link>https://brunoluiz.net/2017/aug/joi-validate-input-and-define-databases-in-javascript/</link><guid isPermaLink="false">https://brunoluiz.net/2017/aug/joi-validate-input-and-define-databases-in-javascript/</guid><pubDate>Wed, 30 Aug 2017 19:44:37 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3b7a8c8cd751a67c7db21ec8d7de792c/d612b/header.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABQAE/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABNXy6hGHj/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIAAwQSExQj/9oACAEBAAEFAhMXWtFtRgOOuD2XqtP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAaEAADAQADAAAAAAAAAAAAAAAAAQIhESJB/9oACAEBAAY/AiqrEcqkdkPxGWj/xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhMUFx/9oACAEBAAE/IYujPfTrMuhR0ZKz+RHwH//aAAwDAQACAAMAAAAQs8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAdEAEBAAIBBQAAAAAAAAAAAAABEQAhMUFRgaGx/9oACAEBAAE/ECo0uCEQkLTcwRYd2J4wiU5wlfesJfXgbR6Nz6oEz//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by Rayi Christian Wicaksono&quot;
        title=&quot;&quot;
        src=&quot;/static/3b7a8c8cd751a67c7db21ec8d7de792c/bef22/header.jpeg&quot;
        srcset=&quot;/static/3b7a8c8cd751a67c7db21ec8d7de792c/257c2/header.jpeg 195w,
/static/3b7a8c8cd751a67c7db21ec8d7de792c/d0630/header.jpeg 390w,
/static/3b7a8c8cd751a67c7db21ec8d7de792c/bef22/header.jpeg 780w,
/static/3b7a8c8cd751a67c7db21ec8d7de792c/1257c/header.jpeg 1170w,
/static/3b7a8c8cd751a67c7db21ec8d7de792c/731f5/header.jpeg 1560w,
/static/3b7a8c8cd751a67c7db21ec8d7de792c/d612b/header.jpeg 1600w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;As the saying goes: &lt;em&gt;never trust user input&lt;/em&gt;. People coming from PHP and Java have many validation libraries available. But what about JavaScript? There are some options, but none seems more interesting than Joi.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hapijs/joi&quot;&gt;Joi&lt;/a&gt; is maintained by &lt;a href=&quot;https://hapijs.com/&quot;&gt;Hapi.js project&lt;/a&gt;. Even though hapi.js is a web framework by itself, Joi is independent and can be used in any type of node project. This is great for people using express or restify, for example.&lt;/p&gt;
&lt;p&gt;What makes it even more interesting is that, besides user validation, it can be used to define database schemas as well. This post will introduce a quick start guide, with some usage cases and general tweaks.&lt;/p&gt;
&lt;h2&gt;How to use it?&lt;/h2&gt;
&lt;p&gt;First things first: it has to be installed on the project. Considering an already initiated node project, the command to install it is: npm install joi. After being installed, a schema is required to use it, such as the file &lt;code&gt;rating-schema.js&lt;/code&gt; below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// rating-schema.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Joi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;joi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  username&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  rating&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;required&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This defines a model where an username, a rating (from 1 to 5) and an email (which is a required field) are expected. This is a simple example, but there are way more validation options, which can be found on the &lt;a href=&quot;https://github.com/hapijs/joi/blob/v10.6.0/API.md&quot;&gt;API reference&lt;/a&gt;. To use the defined schema, consider a file called &lt;code&gt;rating-test.js&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// rating-test.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; schema &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./rating-schema&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  username&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;brunoluiz&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  rating&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;contact@brunoluiz.net&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// result.error will be null&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// result.error will show an error due to missing e-mail&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; resultWithError &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  username&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;brunoluiz&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  rating&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resultWithError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// result.error will have an error message&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hapijs/joi/blob/v10.6.0/API.md#errors&quot;&gt;More about Joi errors&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Real project usage&lt;/h2&gt;
&lt;h3&gt;Validation middleware&lt;/h3&gt;
&lt;p&gt;In a real project, Joi can be used on a middleware layer. On &lt;a href=&quot;http://expressjs.com&quot;&gt;&lt;code&gt;express&lt;/code&gt;&lt;/a&gt;, for example, this can be done using:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ratings-validor.js&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ratings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Ratings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ratings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ratings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parsed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ratings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ....&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// routes.js&lt;/span&gt;

app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/ratings&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ratingsValidator&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ratingsCreateController&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this case, if the &lt;code&gt;ratingsValidator&lt;/code&gt; returns an error due to validation, express will stop the request before even reaching the controller.&lt;/p&gt;
&lt;h3&gt;Database schema (MongoDB and DynamoDB)&lt;/h3&gt;
&lt;p&gt;Some tools can use it to define their database schema (keep in mind that Joi is not an ORM). For MongoDB, &lt;code&gt;mongoose&lt;/code&gt; can be used together with &lt;a href=&quot;https://github.com/yoitsro/joigoose&quot;&gt;&lt;code&gt;joigoose&lt;/code&gt;&lt;/a&gt;, which easily converts a Joi schema. For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// rating.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mongoose &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mongoose&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; joigoose &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;joigoose&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mongoose&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Require the &apos;ratings&apos; schema&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; schema &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./rating-schema&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Convert joi to mongoose schema&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mongooseSchema &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; joigoose&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Modify some fields with database specific instructions&lt;/span&gt;
mongooseSchema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;unique &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Add fields which don&apos;t make sense on the schema validator&lt;/span&gt;
mongooseSchema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;updatedAt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
mongooseSchema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;createdAt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Define mongoose model&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Ratings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mongoose&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Ratings&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mongooseSchema&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Ratings&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Through &lt;a href=&quot;https://github.com/ryanfitz/vogels&quot;&gt;&lt;code&gt;vogels&lt;/code&gt;&lt;/a&gt;, the same can be done in projects using DynamoDB. By default, it accepts Joi as its schema definition. The following example is based on &lt;code&gt;vogels&lt;/code&gt; documentation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// blog-post-schema.js&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  email&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  title&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  content&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  tags&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; vogels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;types&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stringSet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// blog-post.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; schema &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./blog-post-schema.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vogels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;BlogPost&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  hashKey&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;email&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  rangeKey&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; â€˜titleâ€™&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  schema
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Exchangeability for front-end validation&lt;/h3&gt;
&lt;p&gt;Some developers prefer to define the schema once and then use everywhere, including on browsers. Today &lt;a href=&quot;https://github.com/hapijs/joi/#browsers&quot;&gt;Joi doesnâ€™t support browser usage&lt;/a&gt;, but a package called &lt;a href=&quot;https://github.com/jeffbski/joi-browser&quot;&gt;&lt;code&gt;joi-browser&lt;/code&gt; does this job&lt;/a&gt;, enabling the usage of exactly the same schema on the front-end as well.&lt;/p&gt;
&lt;h2&gt;Useful tweaks&lt;/h2&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7711ddf8c0852584701f24f93b2988d7/6a6aa/tweaking.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFBP/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHKyUYkjCf/xAAaEAADAQADAAAAAAAAAAAAAAABAgMAERIi/9oACAEBAAEFAlnyDAYx03Kv280oQ3//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwFX/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BR//EABkQAAIDAQAAAAAAAAAAAAAAAAAxEBIhYf/aAAgBAQAGPwKGVfRGH//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExYaH/2gAIAQEAAT8h9yJ6Uyhz4jF8Q6KMiUpU/9oADAMBAAIAAwAAABAQ/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAwEBPxBJ/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Qi3//xAAcEAEAAgMAAwAAAAAAAAAAAAABABEhUWExgcH/2gAIAQEAAT8QI3EYJeGGOph7FIVDXg+9wFAslbpCUQRsv7P/2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Photo by chuttersnap on Unsplash&quot;
        title=&quot;&quot;
        src=&quot;/static/7711ddf8c0852584701f24f93b2988d7/bef22/tweaking.jpeg&quot;
        srcset=&quot;/static/7711ddf8c0852584701f24f93b2988d7/257c2/tweaking.jpeg 195w,
/static/7711ddf8c0852584701f24f93b2988d7/d0630/tweaking.jpeg 390w,
/static/7711ddf8c0852584701f24f93b2988d7/bef22/tweaking.jpeg 780w,
/static/7711ddf8c0852584701f24f93b2988d7/1257c/tweaking.jpeg 1170w,
/static/7711ddf8c0852584701f24f93b2988d7/731f5/tweaking.jpeg 1560w,
/static/7711ddf8c0852584701f24f93b2988d7/48b41/tweaking.jpeg 2340w,
/static/7711ddf8c0852584701f24f93b2988d7/6a6aa/tweaking.jpeg 4000w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;#1 Disable Joi number() convert&lt;/h3&gt;
&lt;p&gt;By default, Joi allows users to pass numbers formatted as strings, in cases of number() fields. This is specially bad if the validate() result is only used to check if there was an error, but not for itâ€™s value field. To solve this, there are two possible solutions&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;On &lt;code&gt;schema.validate(value)&lt;/code&gt;, an extra parameter can be passed to disable it, as: &lt;code&gt;schema.validate(value, { convert: false })&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Put a &lt;code&gt;strict()&lt;/code&gt; at the end of the desired number field, as: &lt;code&gt;Joi.number().strict()&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Both of them are quite annoying, because either all fields or all function calls require a specific config. One way to solve this is by extending Joiâ€¦&lt;/p&gt;
&lt;h3&gt;#2 Extend Joi defaults&lt;/h3&gt;
&lt;p&gt;In cases such as the above, or for new field types, or even when the behavior of a default field has to be changed, &lt;code&gt;Joi.extend()&lt;/code&gt; can be an option.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// joi.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Joi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;joi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ukzip &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/^[A-Z]{1,2}[0-9]{1,2}[A-Z]{0,1} ?[0-9][A-Z]{2}$/i&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    base&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;strict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;zipcode&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    base&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;regex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ukzip&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;UK Zipcode&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When using Joi through this file, all number fields will be on the strict mode â€” which solves the issue of applying tweak #1 everywhere â€” and a &lt;code&gt;zipcode()&lt;/code&gt; validator is created, based on a pre-defined regex.&lt;/p&gt;
&lt;p&gt;More rules can be added and, actually, the Joi API enables &lt;a href=&quot;https://github.com/hapijs/joi/blob/v10.6.0/API.md#extendextension&quot;&gt;much more customisation&lt;/a&gt; on &lt;code&gt;Joi.extend&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;#3 Create default fields&lt;/h3&gt;
&lt;p&gt;In some projects, a lot of models will have some default fields, such as an &lt;code&gt;extensionAttributes&lt;/code&gt;, where custom vendor data will be put into (as Magento already does) or &lt;code&gt;updatedAt&lt;/code&gt;. In these cases, the &lt;code&gt;Joi.object&lt;/code&gt; can be extended to include default fields:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// joi.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Joi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;joi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;object&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  base&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    extensionAttributes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    updatedAt&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Date&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;#4 Show all validation errors&lt;/h3&gt;
&lt;p&gt;Usually Joi validation dies on the first error, returning on itâ€™s message which field failed. This is an issue when an input have many fields with problems. The user will have to do many requests to discover all problematic fields. To fix this issue, the following option can be added on the function call:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;const result = schema.validate(value, { abortEarly: false })&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;With this config, if an error occurs, the &lt;code&gt;result.error&lt;/code&gt; will return all validation failures.&lt;/p&gt;
&lt;h3&gt;#5 Built-in Joi conditional validations&lt;/h3&gt;
&lt;p&gt;If a field depends on values from another field, the conditional when() can be used.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-js line-numbers&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// joi-from-doc.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Joi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;joi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; schema &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      is&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      then&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;y&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      otherwise&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;z&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Joi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;x&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// valid&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;z&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// valid&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;z&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// valid&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;y&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// invalid&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;validate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;y&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// valid&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this case, the field &lt;code&gt;a&lt;/code&gt; accepts the values &lt;code&gt;x, y, z&lt;/code&gt;. But, to accept &lt;code&gt;y&lt;/code&gt; as a value, the field b have to be equals 5, otherwise only &lt;code&gt;x&lt;/code&gt; and &lt;code&gt;z&lt;/code&gt; will be accepted.&lt;/p&gt;
&lt;p&gt;Of course, this is a simple and fictitious conditional validation, but it is quite useful in cases where some field requires a specific validator when some other had a specific input.&lt;/p&gt;
&lt;h2&gt;Are you ready to use it?&lt;/h2&gt;
&lt;p&gt;I hope this post convinced you to use some validation tool such as Joi, instead of validating everything by hand (or not validating at all). But, if you are using it already: do you know any other cool trick or tweak? Let me know in the comments section below.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Joi repo: &lt;a href=&quot;https://github.com/hapijs/joi&quot;&gt;https://github.com/hapijs/joi&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Joi API Reference: &lt;a href=&quot;https://github.com/hapijs/joi/blob/v10.6.0/API.md&quot;&gt;https://github.com/hapijs/joi/blob/v10.6.0/API.md&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Joigoose repo: &lt;a href=&quot;https://github.com/yoitsro/joigoose&quot;&gt;https://github.com/yoitsro/joigoose&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Joi-browser repo: &lt;a href=&quot;https://github.com/jeffbski/joi-browser&quot;&gt;https://github.com/jeffbski/joi-browser&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mongoose website: &lt;a href=&quot;http://mongoosejs.com&quot;&gt;http://mongoosejs.com&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Vogels repo: &lt;a href=&quot;https://github.com/ryanfitz/vogels&quot;&gt;https://github.com/ryanfitz/vogels&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Still using GitFlow? What about a simpler alternative?]]></title><description><![CDATA[GitFlow is a branching model created by Vincent Driessen on 2010 ( original article ). Since it was published, many companies had tested andâ€¦]]></description><link>https://brunoluiz.net/2017/jul/still-using-gitflow-what-about-a-simpler-alternative/</link><guid isPermaLink="false">https://brunoluiz.net/2017/jul/still-using-gitflow-what-about-a-simpler-alternative/</guid><pubDate>Tue, 18 Jul 2017 19:44:37 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/35506/header.jpeg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 780px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.64999999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAGOvC5YBwn/xAAcEAEAAQQDAAAAAAAAAAAAAAACAQADBBEhIzH/2gAIAQEAAQUCszJSyGjql1k+vhf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPwGH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAwEBAAAAAAAAAAAAAAAAABAhEQH/2gAIAQEABj8CkM6oYv/EABsQAQACAgMAAAAAAAAAAAAAAAEAESExQVFh/9oACAEBAAE/Ibe7HMbuB4bi7xKUbplmXWw2ls//2gAMAwEAAgADAAAAEJAP/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8QI//EABYRAQEBAAAAAAAAAAAAAAAAAAAhEf/aAAgBAgEBPxC4r//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESFRMUFhsfH/2gAIAQEAAT8QC3Q0LT5GFURcw9RKo1fcAS2nPMRaGkHPmU2gO5//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Alternative on sight&quot;
        title=&quot;&quot;
        src=&quot;/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/bef22/header.jpeg&quot;
        srcset=&quot;/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/257c2/header.jpeg 195w,
/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/d0630/header.jpeg 390w,
/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/bef22/header.jpeg 780w,
/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/1257c/header.jpeg 1170w,
/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/731f5/header.jpeg 1560w,
/static/1fa7f07e5b4b36dba90e9f44c0e2d5cd/35506/header.jpeg 2000w&quot;
        sizes=&quot;(max-width: 780px) 100vw, 780px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;GitFlow is a branching model created by Vincent Driessen on 2010 (&lt;a href=&quot;http://nvie.com/posts/a-successful-git-branching-model/&quot;&gt;original article&lt;/a&gt;). Since it was published, many companies had tested and implemented it, which allows us to have many reviews about how well (or not) it works. After some discussions within our team, we decided to not go with GitFlow, but use a simpler model instead, together with a tightly defined workflow. Some of the discussed reasons of why not go with GitFlow are the same written on &lt;a href=&quot;http://endoflineblog.com/gitflow-considered-harmful&quot;&gt;this blog post&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;The Feature Branch Model&lt;/h2&gt;
&lt;p&gt;Compared to GitFlow, it is easier to implement and does not require any plugins to be properly used. The step-by-step of this model would be:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Create a branch from the master (feature-x), which is where the feature will be developed: &lt;code&gt;git checkout -b feature-x&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Push the branch to the remote: &lt;code&gt;git push -u origin feature-x&lt;/code&gt;. With the branch in the remote repo, a pull request should be opened with it (&lt;a href=&quot;https://help.github.com/articles/creating-a-pull-request/&quot;&gt;How to open it in GitHub&lt;/a&gt;). A pull request is where all modifications are available to other members and they will be able to review it&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Fix the reviewed code and wait for approval. If a new release on the master generates a conflict, a best practice would be to rebase it (instead of merging)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(optional) If a rebase is needed: checkout to master &lt;code&gt;git checkout master&lt;/code&gt;, pull the changes &lt;code&gt;git pull&lt;/code&gt;, go back to the feature branch &lt;code&gt;git checkout feature-x&lt;/code&gt;, do the rebase &lt;code&gt;git rebase master&lt;/code&gt; and then sync the rebased branch &lt;code&gt;git push --force-with-lease&lt;/code&gt;. &lt;a href=&quot;https://www.atlassian.com/git/tutorials/merging-vs-rebasing&quot;&gt;A good tutorial about merging x rebasing is available on this Atlassian article&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If there are no conflicts and it was approved â‡’ &lt;strong&gt;squash + merge&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&quot;https://www.atlassian.com/git/tutorials/comparing-workflows#feature-branch-workflow&quot;&gt;This Atlassian article have a more detailed view on the feature branch model&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Why Squash + Merge instead of just Merge?&lt;/h3&gt;
&lt;p&gt;The squash and merge is made up of two processes: the squash, which compact all commits in one big commit/patch, and then the merge itself. After squashing + merging, you will have only one commit in the target branch (usually master) containing all your modifications. This enables two things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;It is easier to move this feature, as the whole patch/feature will be on one commit hash&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The target branch will be cleaner, less messy and more readable â€” without those 67 commits you have made to finish the feature.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There are more information about &lt;a href=&quot;https://softwareengineering.stackexchange.com/questions/263164/why-squash-git-commits-for-pull-requests&quot;&gt;about why devs prefers squash and merge, instead of only merging, on this article&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Managing release versions with git tags&lt;/h2&gt;
&lt;p&gt;In the feature branch model, a merge is considered a new version release. To track each release version, tags can be used. These will be used as reference to choose which version should be deployed at the servers.&lt;/p&gt;
&lt;p&gt;To manage these tags/release, a good practice is the usage of &lt;a href=&quot;http://semver.org&quot;&gt;*semantic versioning&lt;/a&gt;:*&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Given a version number &lt;strong&gt;MAJOR.MINOR.PATCH&lt;/strong&gt;, increment the:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;MAJOR version when you make incompatible API changes,&lt;/li&gt;
&lt;li&gt;MINOR version when you add functionality in a backwards-compatible manner, and&lt;/li&gt;
&lt;li&gt;PATCH version when you make backwards-compatible bug fixes.&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;The process to create the releases can be automated using &lt;a href=&quot;https://github.com/geddski/grunt-release&quot;&gt;&lt;code&gt;grunt-release&lt;/code&gt;&lt;/a&gt; or &lt;a href=&quot;https://github.com/lfender6445/gulp-release-tasks&quot;&gt;&lt;code&gt;gulp-release-tasks&lt;/code&gt;&lt;/a&gt;. But, following the steps bellow, it can be easily done by hand:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Checkout to the master branch: &lt;code&gt;git checkout master&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pull changes from the remote &lt;code&gt;git pull&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Get the most recent tag using &lt;code&gt;git describe --abbrev=0&lt;/code&gt; (letâ€™s say it returns v0.1.0)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create a tag using &lt;code&gt;git tag -a &amp;#x3C;version&gt;&lt;/code&gt;â‡’&lt;code&gt;git tag -a v0.2.0&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Push the modifications and the tag: &lt;code&gt;git push origin v0.2.0 --follow-tags&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Done!&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Deploying&lt;/h2&gt;
&lt;p&gt;In many PaaS, such as AWS Beanstalk or Heroku, a remote repository is set-up where, when changes are pushed (eg. git push heroku master), a deploy is triggered using the latest commits on master. In these cases, a simple push force using the release tag will deploy the desired version: &lt;code&gt;git push -f &amp;#x3C;deploy/env-remote&gt; v0.2.0:master&lt;/code&gt;. Easy, eh?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;NOTE: At Chaordic New Offers Team, a grunt script was developed where we publish which tag should be deployed: &lt;code&gt;grunt deploy:&amp;#x3C;version&gt;:&amp;#x3C;env&gt;:all&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;What happens if a hot-fix is needed?&lt;/h2&gt;
&lt;p&gt;At some point, an issue will be raised and the production version will need a hot-fix &lt;em&gt;ASAP&lt;/em&gt;. A feature branch canâ€™t just be opened to develop a fix, as the master will probably be ahead of the production version. In this case, the fix needs to be done directly on the production version:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Checkout to the production version tag &lt;code&gt;git checkout v0.10.0&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create a new branch from this tag &lt;code&gt;git checkout -b hotfix-v0.10.1-weirdbehavior&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create the fix and commit it&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create a tag for this new release &lt;code&gt;git tag -a v0.10.1&lt;/code&gt; (notice the SEMVER pattern)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Push the branch and tag to remote &lt;code&gt;git push -u origin hotfix-v0.10.1-weirdbehavior --follow-tags&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Deploy the tag &lt;code&gt;v0.10.1&lt;/code&gt; to the production environment&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A push request should be opened, as the fix should be applied at the master afterwards&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If more patches are needed, this process can be repeated on the same version, incrementing only the patch version.&lt;/p&gt;
&lt;h3&gt;What about applying it to other environments?&lt;/h3&gt;
&lt;p&gt;This patch probably should be applied to other environments as well, which can be done through &lt;a href=&quot;http://think-like-a-git.net/sections/rebase-from-the-ground-up/cherry-picking-explained.html&quot;&gt;git cherry-pick&lt;/a&gt; &lt;commit-hash&gt; . It basically applies the chosen commit to the actual HEAD.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Checkout to the environment version tag &lt;code&gt;git checkout v0.13.0&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create a new branch for the patch &lt;code&gt;git checkout -b hotfix-v0.13.1&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Do a &lt;code&gt;git cherry-pick v0.10.1&lt;/code&gt; or a &lt;code&gt;git cherry-pick &amp;#x3C;commit-hash&gt;&lt;/code&gt; to apply the desired commit&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;git tag -a v0.13.1&lt;/code&gt; and &lt;code&gt;git push origin v0.13.1&lt;/code&gt; (push just the tag)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Deploy it&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;What if I want to get a modification from master and sent to one of the environments?&lt;/h3&gt;
&lt;p&gt;It is very similar to the above one: a &lt;code&gt;git cherry-pick&lt;/code&gt; should be done using a commit hash from the master as, after &lt;strong&gt;squash + merge&lt;/strong&gt; a push request, a new commit is generated with all changes (big patch of commits condensed in one).&lt;/p&gt;
&lt;h2&gt;Just keep in mindâ€¦&lt;/h2&gt;
&lt;p&gt;The gap between the environments versions should be as short as possible. Otherwise, some issues may appear:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;If the production is on &lt;code&gt;v0.1.10&lt;/code&gt;, the latest release is &lt;code&gt;v0.10&lt;/code&gt;, but the version &lt;code&gt;v0.3&lt;/code&gt; will be deployed: the team members will have to check if some of the production patches are still required and then apply them, one by one.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If some feature was only finished on &lt;code&gt;v0.10.0&lt;/code&gt;, and it is required for the roll-out, but the &lt;code&gt;v0.7.0&lt;/code&gt; is still not well tested: the release should be hold until the &lt;code&gt;v0.7.0&lt;/code&gt; has been tested&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Usually, these version gaps occur when the producing capacity is higher than the testing capacity (developers x testers ratio).&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The model is still being tested but, until now, it has been working well. The only faced drawbacks were the ones pointed on the session above.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Are you using git push force? Oh mate, you are doing it wrong!]]></title><description><![CDATA[You are developing some feature together with your team. Most likely you have done the usual dance: checkout a branch from the master orâ€¦]]></description><link>https://brunoluiz.net/2017/jun/are-you-using-git-push-force-oh-mate-you-are-doing-it-wrong/</link><guid isPermaLink="false">https://brunoluiz.net/2017/jun/are-you-using-git-push-force-oh-mate-you-are-doing-it-wrong/</guid><pubDate>Sat, 03 Jun 2017 19:44:37 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/620d3f100a056fc03663181b22d8cbbd/faf19/header.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 778px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 64.52442159383034%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAC7ElEQVQ4y41Ta0hTYRh+d7wVBUGQhV3MyiiFLnYRSQgTISpI0Gbaj4JQMwuV1IjR0LLAyhzoHOZlmZuRWohGoqRky5VzM7wxzcvcpu5ydnU7uyju62x60kDKFw7f85zvPc/38bzPAfOc8abBbJA4CGsiLJcOV2MOh41GcZvNCgWMLFhXGY0ql805hyZkUsStq4hOAsCovUFxFxZ1MtSDS57nr090zjDLVKkmrMMNZcaBjLgI97sFwhqGkCuE6hmQiIDkHkwQFph32v8teqimLq8p42osOuHLIHjFpSqTjtBqVcTYoCiF3PZGCHlujWumvdwryaGKXQiPGffWFsRYFUzIRN4e/9rrWYuLBLJb1UjQ3faW6iFFaJQYVWtaYLLoM0ZUs1pcp85a+dgWjwua+C76kUKUcPAATphLjSaD2GrQxlCiR8nVbreB02GnUXYszDsAZnRTaN5pRvLJUZRSzkuFvEdhkPMwGHILA69fOHPxc/5toQsRyEEObkgqUaYlJ+1BuYnYF1nPnxTIx4ex2sri5SlrZHc0M1OK7+1PNXT2jUYoak6GF7zUwFd8RlDjpyfwsuqKSqPgKEfEtqEyZlc5gM8qG7zIZzfF62vYS0D4U7FFVAYBCi5k6rmQjrfCzgnj5HuXxYQjszbN3SMVtmyzn/WPIy4dZC2e3x9JqmE9ammzXo8vGHRq5rG9ywepZ2ex1Z52l0DEtw+nePzpTtQl60XD4i4jMzc9nE6P9/MMLSl8hyMqIFubFVtRLf242CH7gUb7BIaigvvnsu/e2kweFAOjkw4Q8UNo0o5rnlhYLGi7Dp+yaAwy1Cdo0HRwtrJ7q72LJJW0Z6JayBfWwgNpWXCLXj5o1VmUSCJsnSzksPalRUd6QW8VgLgaoO/10g2VnQkeUatZe1w51s/52sY77eYj7zb69XAxv/4S7w2/OEGbPAlxmkJnxgc48pyEN/NhvkF/xcctumK25b9/GNq1kkcS+RgvH/Z3498UIZyNb70hSwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Git branching&quot;
        title=&quot;&quot;
        src=&quot;/static/620d3f100a056fc03663181b22d8cbbd/faf19/header.png&quot;
        srcset=&quot;/static/620d3f100a056fc03663181b22d8cbbd/d94ba/header.png 195w,
/static/620d3f100a056fc03663181b22d8cbbd/bedd7/header.png 390w,
/static/620d3f100a056fc03663181b22d8cbbd/faf19/header.png 778w&quot;
        sizes=&quot;(max-width: 778px) 100vw, 778px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;You are developing some feature together with your team. Most likely you have done the usual dance: checkout a branch from the master or development branch, done your commits, pushed this feature branch to the remote and opened a push request for peer review.&lt;/p&gt;
&lt;p&gt;In ideal cases, you will be able to just squash and merge after some reviews and fixes. But, the world is not ideal (as you might know), and maybe one of your mates modified the same files and already merged it. So, surprise surprise, you got a merge conflict to resolve!&lt;/p&gt;
&lt;p&gt;This usually means you will need to do a &lt;em&gt;git rebase&lt;/em&gt; before merging. After doing it, this new rebased branch need to be pushed back to the remote. And here is one of the steps that people usually do wrong:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-sh line-numbers&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;git push â€”-force&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You might be thinking: what is the problem with this?&lt;/p&gt;
&lt;p&gt;Well, &lt;strong&gt;push force&lt;/strong&gt; ignore everything on the remote and override it with local changes. This is â€œkindaâ€ what you want, but what if you did some mistake in the rebase but didnâ€™t notice? Or someone pushed more modifications while you were rebasing? Yes, you thought right: kaputt, gone. One safer way to do this is using:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-sh line-numbers&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;git push --force-with-lease&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This simple command will not push force your modifications until it checked if everything that is in the remote is also in your rebased version. It is the same as a &lt;em&gt;push force&lt;/em&gt;, but safer.&lt;/p&gt;
&lt;p&gt;If you want to know more about it, checkout &lt;a href=&quot;https://developer.atlassian.com/blog/2015/04/force-with-lease/&quot;&gt;this article&lt;/a&gt;. But the basic idea is: &lt;strong&gt;start to use &lt;em&gt;force-with-lease&lt;/em&gt; instead of &lt;em&gt;force&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;</content:encoded></item></channel></rss>